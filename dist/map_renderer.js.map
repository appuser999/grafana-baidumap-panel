{"version":3,"sources":["../src/map_renderer.js"],"names":["link","scope","elem","attrs","ctrl","events","on","render","renderingCompleted","data","map","mapContainer","find","id","indexOf","MP","panel","ak","then","console","log","elementId","BMap","Map","centerAndZoom","Point","lng","lat","parseInt","initialZoom","enableScrollWheelZoom","setMapStyle","style","theme","navigationSwitch","NavigationControl","scaleSwitch","ScaleControl","overviewMapSwitch","OverviewMapControl","isOpen","anchor","BMAP_ANCHOR_BOTTOM_RIGHT","trafficMapSwitch","BMapLib","TrafficControl","showPanel","mapTypeSwitch","MapTypeControl","navigation","addControl","scale","overviewMap","mapType","addEventListener","center","getCenter","menu","ContextMenu","txtMenuItem","text","callback","openDistanceTool","openRectangleZoom","closeRectangleZoom","menuIndex","length","addItem","MenuItem","addContextMenu","addNode"],"mappings":"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","file":"map_renderer.js","sourcesContent":["/* eslint-disable no-plusplus */\nimport './css/leaflet.css!';\nimport {MP} from './libs/baidumap.js';\n\n\nexport default function link(scope, elem, attrs, ctrl) {\n    ctrl.events.on('render', () => {\n        render();\n        ctrl.renderingCompleted();\n    });\n\n    function render() {\n        if (!ctrl.data && ctrl.map) return;\n\n        const mapContainer = elem.find('.mapcontainer');\n\n        if (mapContainer[0].id.indexOf('{{') > -1) {\n            return;\n        }\n\n        if (!ctrl.map) {\n            MP(ctrl.panel.ak)\n                .then(BMap => {\n                    console.log('start');\n                    const elementId = 'mapid_' + ctrl.panel.id;\n                    ctrl.BMap = BMap;\n                    ctrl.map = new BMap.Map(elementId);\n                    ctrl.map.centerAndZoom(new BMap.Point(ctrl.panel.lng, ctrl.panel.lat), parseInt(ctrl.panel.initialZoom, 10));\n                    ctrl.map.enableScrollWheelZoom();\n                    ctrl.map.setMapStyle({style: ctrl.panel.theme});\n\n                    ctrl.navigationSwitch = new BMap.NavigationControl();\n                    ctrl.scaleSwitch = new BMap.ScaleControl();\n                    ctrl.overviewMapSwitch = new BMap.OverviewMapControl({\n                        isOpen: true,\n                        anchor: BMAP_ANCHOR_BOTTOM_RIGHT\n                    });\n                    ctrl.trafficMapSwitch = new BMapLib.TrafficControl({\n                        showPanel: false,\n                        anchor: BMAP_ANCHOR_BOTTOM_RIGHT\n                    });\n                    ctrl.mapTypeSwitch = new BMap.MapTypeControl();\n\n                    if (ctrl.panel.navigation === true) ctrl.map.addControl(ctrl.navigationSwitch);\n                    if (ctrl.panel.scale === true) ctrl.map.addControl(ctrl.scaleSwitch);\n                    if (ctrl.panel.overviewMap === true) ctrl.map.addControl(ctrl.overviewMapSwitch);\n                    if (ctrl.panel.mapType === true) ctrl.map.addControl(ctrl.mapTypeSwitch);\n\n                    ctrl.map.addEventListener('dragend', function () {\n                        const center = ctrl.map.getCenter();\n                        ctrl.panel.lat = center.lat;\n                        ctrl.panel.lng = center.lng;\n                    });\n\n                    const menu = new BMap.ContextMenu();\n                    const txtMenuItem = [\n                        {\n                            text: '测距',\n                            callback: function () {\n                                ctrl.openDistanceTool();\n                            }\n                        },\n                        {\n                            text: '开启拉框放大',\n                            callback: function () {\n                                ctrl.openRectangleZoom();\n                            }\n                        },\n                        {\n                            text: '关闭拉框放大',\n                            callback: function () {\n                                ctrl.closeRectangleZoom();\n                            }\n                        }\n                    ];\n\n                    for (let menuIndex = 0; menuIndex < txtMenuItem.length; menuIndex++) {\n                        menu.addItem(new BMap.MenuItem(txtMenuItem[menuIndex].text, txtMenuItem[menuIndex].callback, 100));\n                    }\n                    ctrl.map.addContextMenu(menu);\n\n                    ctrl.addNode(BMap);\n                });\n        }\n\n        //ctrl.map.resize();\n\n        //if (ctrl.mapCenterMoved) ctrl.map.panToMapCenter();\n\n        //if (!ctrl.map.legend && ctrl.panel.showLegend) ctrl.map.createLegend();\n\n        //ctrl.map.drawCircles();\n    }\n}\n"]}