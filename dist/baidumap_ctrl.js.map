{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["getColor","orginBili","alpha","bili","one","r","g","b","yellowValue","fullRedValue","darkRedWeight","parseInt","getDotRect","mp","lng","lat","squareSize","isCenterPoint","standardLen","xScale","Math","cos","PI","lngDelta","latDelta","pixel","pointToPixel","window","BMap","Point","pixel2","x","y","w","h","MetricsPanelCtrl","TimeSeries","kbn","_","mapRenderer","DataFormatter","panelDefaults","ak","maxDataPoints","theme","initialZoom","valueName","locationData","gpsType","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","clusterPoint","globalConfig","typeName","posName","extName","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","poiType","poiConfig","defaultValue","configName","typeOption","getPoiExt","poiOption","Object","assign","length","extJson","JSON","parse","tileServer","setMapSaturationClass","saturationClass","reload","map","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","data","setGeohashValues","tableData","tableHandler","setTableValues","tableHandlers","datas","splice","addNode","render","clearOverlays","point","markerOption","getPoiOption","iconUrl","Number","isInteger","icon","Icon","Size","offset","imageOffset","imageSize","anchor","marker","Marker","pointLabel","label","Label","setLabel","push","enableDragging","scontent","infoWindow","InfoWindow","addEventListener","openInfoWindow","addOverlay","setAnimation","BMAP_ANIMATION_BOUNCE","e","alert","that","poiList","console","log","translateOne","poiIndex","gpsIndex","gps","rawLength","translateCallback","returnedData","status","translatedItems","points","sort","a","translateIndex","translatedItem","poiIndexKey","heatPoint","count","heatArray","pointItem","lineMap","option","layerItem","color","size","type","layerArray","markerArray","isSupportCanvas","elem","document","createElement","getContext","heatmapOverlay","BMapLib","HeatmapOverlay","radius","setDataSet","max","lineCount","keys","i","lines","values","v","driving","RidingRoute","renderOptions","autoViewport","search","slice","polyline","Polyline","enableEditing","enableClicking","strokeWeight","strokeOpacity","strokeColor","addMarker","MarkerClusterer","updateLayer","ctx","canvas","clearRect","width","height","fillStyle","beginPath","fillRect","layerIndex","isPie","posRect","parseFloat","ellipse","fill","canvasLayer","CanvasLayer","paneName","zIndex","update","sourcePointList","Array","sourceGps","sourceGpsId","convertor","translate","Convertor","setTimeout","gpsList","split","gpsStr","gpsItem","filter","o","isNil","value","snapshotData","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","setMapStyle","style","body","s","getElementsByTagName","len","removeChild","addControl","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","stickyLabels","scope","attrs","ctrl","distanceTool","close","DistanceTool","open","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint-disable eqeqeq,id-length,no-inner-declarations,no-plusplus,no-mixed-operators */\n/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\n\nconst panelDefaults = {\n    ak: 'QKCqsdHBbGxBnNbvUwWdUEBjonk7jUj6',\n    maxDataPoints: 1,\n    theme: 'normal',\n    lat: 39.968539,\n    lng: 116.497856,\n    initialZoom: 14,\n    valueName: 'current',\n    locationData: 'json result',\n    gpsType: '百度坐标系',\n    esMetric: 'Count',\n    decimals: 0,\n    navigation: true,\n    scale: true,\n    hideEmpty: false,\n    overviewMap: false,\n    hideZero: false,\n    mapType: true,\n    clusterPoint: false,\n    globalConfig: '',\n    typeName: 'type',\n    posName: 'pos',\n    extName: 'ext'\n};\n\n\nfunction getColor(orginBili, alpha) {\n    const bili = orginBili > 100 ? 100 : orginBili;\n    // 百分之一 = (单色值范围) / 50;  单颜色的变化范围只在50%之内\n    const one = (255 + 255) / 100;\n    let r = 0;\n    let g = 0;\n    let b = 0;\n\n    const yellowValue = 50;\n    const fullRedValue = 95;\n    const darkRedWeight = 0.6;\n\n    if (bili <= yellowValue) {\n        // 比例小于yellowValue的时候红色是越来越多的,直到红色为255时(红+绿)变为黄色.\n        r = one * bili / yellowValue * 50;\n        g = 255;\n    } else if (bili > yellowValue && bili <= fullRedValue) {\n        // 比例大于yellowValue的时候绿色是越来越少的,直到fullRedValue 变为纯红\n        g = 255 - ((bili - yellowValue) / (fullRedValue - yellowValue) * 50 * one);\n        r = 255;\n    } else {\n        // 比例大于fullRedValue 开始转为暗红\n        g = 0;\n        r = 255 * (1 - darkRedWeight * (bili - fullRedValue) / (100 - fullRedValue));\n    }\n    r = parseInt(r, 10);// 取整\n    g = parseInt(g, 10);// 取整\n    b = parseInt(b, 10);// 取整\n    return 'rgb(' + r + ',' + g + ',' + b + ',' + alpha + ')';\n}\n\n// 获取色块对应的矩形相对于地图的像素值\nfunction getDotRect(mp, lng, lat, squareSize = 20, isCenterPoint = true) {\n    const standardLen = 111700;\n    const xScale = Math.cos(lat * Math.PI / 180);\n    const lngDelta = squareSize / (standardLen * xScale);\n    const latDelta = squareSize / (standardLen);\n\n    const pixel = mp.pointToPixel(isCenterPoint ? new window.BMap.Point(lng - lngDelta / 2, lat - latDelta / 2) : new window.BMap.Point(lng, lat));\n    const pixel2 = mp.pointToPixel(isCenterPoint ? new window.BMap.Point(lng + lngDelta / 2, lat + latDelta / 2) : new window.BMap.Point(lng + lngDelta, lat + latDelta));\n    return {\n        x: pixel.x,\n        y: pixel.y,\n        w: pixel2.x - pixel.x,\n        h: pixel2.y - pixel.y,\n    };\n}\n\n\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector, contextSrv) {\n        super($scope, $injector);\n        this.setMapProvider(contextSrv);\n        _.defaults(this.panel, panelDefaults);\n\n        this.dataFormatter = new DataFormatter(this, kbn);\n        this.markers = [];\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n        // this.loadLocationDataFromFile();\n    }\n\n    getPoiOption(poiType, poiConfig, defaultValue = '') {\n        const configName = 'option';\n        const typeOption = this.getPoiExt(poiType, null, configName, defaultValue);\n        const poiOption = this.getPoiExt(poiType, poiConfig, configName, defaultValue);\n        return Object.assign({}, typeOption, poiOption);\n    }\n\n    getPoiExt(poiType, poiConfig, configName, defaultValue = '') {\n        const extName = this.panel.extName;\n        if (poiConfig && extName in poiConfig && poiConfig[extName].length > 0) {\n            const extJson = JSON.parse(poiConfig[extName]);\n            if (configName in extJson) {\n                return extJson[configName];\n            }\n        }\n        if (this.panel.globalConfig && this.panel.globalConfig.length > 0) {\n            const globalConfig = JSON.parse(this.panel.globalConfig);\n            if (poiType in globalConfig && configName in globalConfig[poiType]) {\n                return globalConfig[poiType][configName];\n            }\n        }\n        return defaultValue;\n    }\n\n    setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n        this.tileServer = 'CartoDB Positron';\n        this.setMapSaturationClass();\n    }\n\n    setMapSaturationClass() {\n        if (this.tileServer === 'CartoDB Dark') {\n            this.saturationClass = 'map-darken';\n        } else {\n            this.saturationClass = '';\n        }\n    }\n\n    loadLocationDataFromFile(reload) {\n        if (this.map && !reload) return;\n\n        if (this.panel.snapshotLocationData) {\n            this.locations = this.panel.snapshotLocationData;\n            return;\n        }\n\n        if (this.panel.locationData === 'jsonp endpoint') {\n\n        } else if (this.panel.locationData === 'json endpoint') {\n            if (!this.panel.jsonUrl) return;\n        } else if (this.panel.locationData === 'table') {\n            // .. Do nothing\n\n        } else if (this.panel.locationData !== 'geohash' && this.panel.locationData !== 'json result') {\n\n        }\n    }\n\n    reloadLocations(res) {\n        this.locations = res;\n        this.refresh();\n    }\n\n    onPanelTeardown() {\n        if (this.map) delete this.map;\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n    }\n\n    onDataReceived(dataList) {\n        if (!dataList) return;\n        if (this.dashboard.snapshot && this.locations) {\n            this.panel.snapshotLocationData = this.locations;\n        }\n\n        const data = [];\n        if (this.panel.locationData === 'geohash') {\n            this.dataFormatter.setGeohashValues(dataList, data);\n        } else if (this.panel.locationData === 'table') {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else if (this.panel.locationData === 'json result') {\n            const tableData = dataList.map(DataFormatter.tableHandlers.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        }\n        // const datas = this.filterEmptyAndZeroValues(data);\n\n        const datas = data;\n        if (typeof this.data === 'object') this.data.splice(0, this.data.length);\n        this.markers.splice(0, this.markers.length);\n        if (datas.length) {\n            this.data = datas;\n\n            this.map ? this.addNode(this.BMap) : this.render();\n        } else {\n            if (this.map) this.map.clearOverlays();\n            this.render();\n        }\n    }\n\n    addMarker(point, BMap, data) {\n        // public/plugins/grafana-baidumap-panel/images/bike.png\n        const poiType = 'marker';\n        const markerOption = this.getPoiOption(poiType, data, {});\n        const iconUrl = this.getPoiExt(poiType, data, 'icon', '');\n        if (Number.isInteger(iconUrl)) {\n            markerOption.icon = new BMap.Icon('http://api.map.baidu.com/img/markers.png', new BMap.Size(23, 25), {\n                offset: new BMap.Size(10, 25), // 指定定位位置\n                imageOffset: new BMap.Size(0, 25 * (10 - (iconUrl % 10)) - 10 * 25) // 设置图片偏移\n            });\n        } else if (iconUrl.length > 0) {\n            markerOption.icon = new BMap.Icon(iconUrl, new window.BMap.Size(24, 28), {\n                imageSize: new window.BMap.Size(24, 28),\n                anchor: new window.BMap.Size(12, 28)\n            });\n        }\n        const marker = new BMap.Marker(point, markerOption);\n        const pointLabel = this.getPoiExt(poiType, data, 'label', '');\n        if (pointLabel.length > 0) {\n            const label = new BMap.Label(pointLabel, {offset: new BMap.Size(20, -10)});\n            marker.setLabel(label);\n        }\n        this.markers.push(marker);\n\n        // this.map.setViewport(pointArray);\n        if (this.getPoiExt(poiType, data, 'enableDragging', false)) {\n            marker.enableDragging();\n        }\n        let scontent = '';\n        scontent += '<a href=\"\"><div class=\"infobox\" id=\"infobox\"><div class=\"infobox-content\" style=\"display:block\">';\n        scontent += '<div class=\"infobox-header\"><div class=\"infobox-header-icon\"><img src=\"' + this.getPoiExt(poiType, data, 'detail-icon', 'public/plugins/grafana-baidumap-panel/images/bike.png') + '\"></div>';\n        scontent += '<div class=\"infobox-header-name\"><p>' + this.getPoiExt(poiType, data, 'name') + '</p></div>';\n        scontent += '<div class=\"infobox-header-type\" style=\"min-width:250px\"><p>' + this.getPoiExt(poiType, data, 'type') + '</p></div></div>';\n        scontent += '<div class=\"infobox-footer\">' + this.getPoiExt(poiType, data, 'desc') + '</div>';\n        scontent += '<div class=\"infobox-footer-right\"></div></div><div class=\"arrow\"></div></div></a>';\n\n        const infoWindow = new BMap.InfoWindow(scontent); // 创建信息窗口对象\n        marker.addEventListener('click', function () {\n            this.map.openInfoWindow(infoWindow, point); // 开启信息窗口\n        });\n\n        this.map.addOverlay(marker);\n        if (this.getPoiExt(poiType, data, 'animation', false)) {\n            marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画\n        }\n        marker.addEventListener('dragend', function (e) {\n            point = new BMap.Point(e.point.lng, e.point.lat);\n            alert('当前位置：' + e.point.lng + ', ' + e.point.lat);\n        });\n    }\n\n    addNode(BMap) {\n        const that = this;\n        const poiList = this.data;\n        this.map.clearOverlays();\n        console.log(poiList);\n        if (poiList) {\n            const lineMap = [];\n            const heatArray = [];\n            const markerArray = [];\n            const layerArray = [];\n            const convertor = new BMap.Convertor();\n\n            let rawLength = 0;\n            const translatedItems = [];\n\n            for (let i = 0; i < poiList.length; i++) {\n                setTimeout((function (poiIndex) {\n                    return function () {\n                        if (poiList[poiIndex][that.panel.posName] && poiList[poiIndex][that.panel.posName].length > 0) {\n                            const gpsList = poiList[poiIndex][that.panel.posName].split(';');\n                            for (let gpsIndex = 0; gpsIndex < gpsList.length; gpsIndex++) {\n                                const gpsStr = gpsList[gpsIndex];\n                                const [lng, lat] = gpsStr.split('|');\n                                const gpsItem = Object.assign({}, poiList[poiIndex]);\n                                gpsItem.lng = parseFloat(lng);\n                                gpsItem.lat = parseFloat(lat);\n                                translateOne(poiIndex, gpsIndex, gpsItem, BMap);\n                            }\n                        }\n                    };\n                }(i)), i * 10);\n            }\n\n            function translateOne(poiIndex, gpsIndex, gps, BMap) {\n                rawLength += 1;\n\n                function translateCallback(returnedData) {\n                    if (returnedData.status == 0) {\n                        translatedItems.push({\n                            poiIndex: poiIndex,\n                            gpsIndex: gpsIndex,\n                            point: returnedData.points[0],\n                            gps: gps,\n                        });\n\n                        if (translatedItems.length == rawLength) {\n                            translatedItems.sort(function (a, b) {\n                                return ((a.poiIndex - b.poiIndex) * 1000000) + (a.gpsIndex - b.gpsIndex);\n                            });\n                            for (let translateIndex = 0; translateIndex < translatedItems.length; translateIndex++) {\n                                const translatedItem = translatedItems[translateIndex];\n                                const poiType = translatedItem.gps[that.panel.typeName];\n                                const poiIndexKey = 'key_' + translatedItem.poiIndex;\n                                if (poiType === 'heat') {\n                                    const heatPoint = {\n                                        lng: translatedItem.point.lng,\n                                        lat: translatedItem.point.lat,\n                                        count: that.getPoiExt(poiType, translatedItem.gps, 'count', 1)\n                                    };\n                                    heatArray.push(heatPoint);\n                                } else if (poiType === 'line' || poiType === 'polygon' || poiType === 'route') {\n                                    const pointItem = translatedItem.point;\n                                    if (poiIndexKey in lineMap) {\n                                        lineMap[poiIndexKey].points.push(pointItem);\n                                    } else {\n                                        const option = Object.assign(\n                                            {},\n                                            that.getPoiOption(poiType, translatedItem.gps, {})\n                                        );\n                                        lineMap[poiIndexKey] = {\n                                            poiType: poiType,\n                                            option: option,\n                                            points: [pointItem]\n                                        };\n                                    }\n                                } else if (poiType === 'pie' || poiType === 'block') {\n                                    const layerItem = {\n                                        lng: translatedItem.point.lng,\n                                        lat: translatedItem.point.lat,\n                                        color: that.getPoiExt(poiType, translatedItem.gps, 'color', 20),\n                                        size: that.getPoiExt(poiType, translatedItem.gps, 'size', 20),\n                                        type: poiType\n                                    };\n                                    layerArray.push(layerItem);\n                                } else {\n                                    markerArray.push({point: translatedItem.point, data: translatedItem.gps});\n                                }\n                            }\n                            console.log('markerArray', markerArray);\n                            console.log('lineMap', lineMap);\n                            console.log('heatArray', heatArray);\n                            console.log('layerArray', layerArray);\n\n                            if (heatArray.length > 0) {\n                                // 热力图\n                                if (!isSupportCanvas()) {\n                                    alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~');\n                                }\n                                // http://xcx1024.com/ArtInfo/271881.html\n                                const heatmapOverlay = new BMapLib.HeatmapOverlay(\n                                    Object.assign(\n                                        {\n                                            radius: 20,\n                                        },\n                                        that.getPoiOption('heat', null, {})\n                                    ));\n                                that.map.addOverlay(heatmapOverlay);\n                                heatmapOverlay.setDataSet({\n                                    data: heatArray,\n                                    max: that.getPoiExt('heat', null, 'max', 100)\n                                });\n\n                                // 判断浏览区是否支持canvas\n                                function isSupportCanvas() {\n                                    const elem = document.createElement('canvas');\n                                    return !!(elem.getContext && elem.getContext('2d'));\n                                }\n                            }\n                            const lineCount = Object.keys(lineMap).length;\n                            if (lineCount > 0) {\n                                for (let i = 0; i < lineCount; i++) {\n                                    const lines = Object.values(lineMap)[i];\n                                    if (lines.points.length < 2) {\n                                        // eslint-disable-next-line no-continue\n                                        continue;\n                                    }\n                                    if (lines.poiType === 'route') {\n                                        const points = lines.points.map(v => new BMap.Point(v.lng, v.lat));\n                                        const driving = new BMap.RidingRoute(that.map, {\n                                            renderOptions: {\n                                                map: that.map,\n                                                autoViewport: true\n                                            }\n                                        });\n                                        driving.search(points[0], points.slice(-1)[0]);\n                                    } else {\n                                        if (lines.poiType === 'polygon') {\n                                            lines.points.push(lines.points[0]);\n                                        }\n                                        const polyline = new BMap.Polyline(lines.points, Object.assign(\n                                            {\n                                                enableEditing: false,\n                                                enableClicking: true,\n                                                strokeWeight: 4,\n                                                strokeOpacity: 0.5,\n                                                strokeColor: 'blue'\n                                            },\n                                            lines.option\n                                            )\n                                        );\n                                        that.map.addOverlay(polyline);\n                                    }\n                                }\n                            }\n                            if (markerArray.length > 0) {\n                                for (let i = 0; i < markerArray.length; i++) {\n                                    that.addMarker(markerArray[i].point, BMap, markerArray[i].data);\n                                }\n                                if (that.panel.clusterPoint) {\n                                    new BMapLib.MarkerClusterer(that.map, {\n                                        markers: that.markers\n                                    });\n                                }\n                            }\n                            if (layerArray.length > 0) {\n                                const canvasLayer = new BMap.CanvasLayer({\n                                    paneName: 'vertexPane',\n                                    zIndex: -999,\n                                    update: updateLayer\n                                });\n\n                                function updateLayer() {\n                                    const ctx = this.canvas.getContext('2d');\n\n                                    if (!ctx) {\n                                        return;\n                                    }\n                                    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                                    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n                                    ctx.beginPath();\n                                    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                                    for (let layerIndex = 0; layerIndex < layerArray.length; layerIndex++) {\n                                        const layerItem = layerArray[layerIndex];\n                                        const poiType = layerItem[that.panel.typeName];\n                                        ctx.fillStyle = getColor(layerItem.color, that.getPoiExt(poiType, null, 'alpha', 0.5));\n                                        const isPie = poiType === 'pie';\n                                        const posRect = getDotRect(that.map, parseFloat(layerItem.lng),\n                                            parseFloat(layerItem.lat), layerItem.size, !isPie);\n                                        // console.log(posRect);\n                                        if (isPie) {\n                                            ctx.ellipse(posRect.x, posRect.y, posRect.w, -posRect.h, 0, 0, 2 * Math.PI);\n                                            ctx.fill();\n                                            ctx.beginPath();\n                                        } else {\n                                            ctx.fillRect(posRect.x, posRect.y, posRect.w, posRect.h);\n                                        }\n                                    }\n                                }\n\n                                that.map.addOverlay(canvasLayer);\n                            }\n                        }\n                    } else {\n                        console.log('转换出错: ' + returnedData.status);\n                    }\n                }\n\n                // 转换坐标\n                const point = new BMap.Point(gps.lng, gps.lat);\n                const sourcePointList = new Array(point);\n                const sourceGps = that.panel.gpsType;\n                let sourceGpsId = 5;\n                if (sourceGps === 'WGS84') {\n                    sourceGpsId = 1;\n                } else if (sourceGps === 'GCJ02') {\n                    sourceGpsId = 3;\n                }\n                convertor.translate(sourcePointList, sourceGpsId, 5, translateCallback);\n            }\n        }\n    }\n\n    filterEmptyAndZeroValues(data) {\n        return _.filter(data, (o) => {\n            return !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n        });\n    }\n\n    onDataSnapshotLoad(snapshotData) {\n        this.onDataReceived(snapshotData);\n    }\n\n    seriesHandler(seriesData) {\n        const series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target,\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n        return series;\n    }\n\n    setNewMapCenter() {\n        this.render();\n    }\n\n    setZoom() {\n        this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n    }\n\n    setStyle() {\n        this.map.setMapStyle({style: this.panel.theme});\n    }\n\n    setAK() {\n        const x = document.body;\n        const s = document.getElementsByTagName('script');\n        const len = s.length;\n        x.removeChild(s[len - 1]);\n        delete this.map;\n        this.render();\n    }\n\n    navigationControl() {\n        if (this.panel.navigation == true) {\n            this.map.addControl(this.navigationSwitch);\n        } else {\n            this.map.removeControl(this.navigationSwitch);\n        }\n    }\n\n    scaleControl() {\n        if (this.panel.scale == true) {\n            this.map.addControl(this.scaleSwitch);\n        } else {\n            this.map.removeControl(this.scaleSwitch);\n        }\n    }\n\n    overviewMapControl() {\n        if (this.panel.overviewMap == true) {\n            this.map.addControl(this.overviewMapSwitch);\n        } else {\n            this.map.removeControl(this.overviewMapSwitch);\n        }\n    }\n\n    mapTypeControl() {\n        if (this.panel.mapType == true) {\n            this.map.addControl(this.mapTypeSwitch);\n        } else {\n            this.map.removeControl(this.mapTypeSwitch);\n        }\n    }\n\n    resize() {\n\n    }\n\n    toggleStickyLabels() {\n        console.log(this.panel.stickyLabels);\n    }\n\n    changeLocationData() {\n        if (this.panel.locationData === 'geohash') {\n            this.render();\n        }\n    }\n\n    /* eslint class-methods-use-this: 0 */\n    link(scope, elem, attrs, ctrl) {\n        mapRenderer(scope, elem, attrs, ctrl);\n    }\n\n    closeDistanceTool() {\n        this.distanceTool.close();\n    }\n    openDistanceTool() {\n        if (!this.distanceTool) {\n            this.distanceTool = new BMapLib.DistanceTool(map);\n        }\n        this.distanceTool.open();\n    }\n\n// 如果要调试事件接口，请打开下方屏蔽代码，\n// 在firefox或者chrome下查看调试信息\n\n    // distanceTool.addEventListener('drawend', function (e) {\n    //     console.log('drawend');\n    //     console.log(e.points);\n    //     console.log(e.overlays);\n    //     console.log(e.distance);\n    // });\n    //\n    // distanceTool.addEventListener('addpoint', function (e) {\n    //     console.log('addpoint');\n    //     console.log(e.point);\n    //     console.log(e.pixel);\n    //     console.log(e.index);\n    //     console.log(e.distance);\n    // });\n    //\n    // distanceTool.addEventListener('removepolyline', function (e) {\n    //     console.log('removepolyline');\n    //     console.log(e);\n    // });\n\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}