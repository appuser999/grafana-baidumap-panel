{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["getPoiExt","poiConfig","configName","defaultValue","ext","length","extJson","JSON","parse","getColor","orginBili","alpha","bili","one","r","g","b","yellowValue","fullRedValue","darkRedWeight","parseInt","getDotRect","_this","lng","lat","squareSize","isCenterPoint","standardLen","xScale","Math","cos","PI","lngDelta","latDelta","pixel","map","pointToPixel","window","BMap","Point","pixel2","x","y","w","h","MetricsPanelCtrl","TimeSeries","kbn","_","mapRenderer","DataFormatter","MP","$","panelDefaults","ak","maxDataPoints","theme","initialZoom","valueName","locationData","gpsType","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","tileServer","setMapSaturationClass","saturationClass","reload","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","data","setGeohashValues","tableData","tableHandler","setTableValues","tableHandlers","datas","splice","addNode","render","clearOverlays","point","myIcon","Icon","Size","imageSize","anchor","marker","Marker","icon","push","enableDragging","scontent","infoWindow","InfoWindow","addEventListener","openInfoWindow","addOverlay","e","alert","that","poiList","console","log","translateOne","poiIndex","gpsIndex","gps","rawLength","translateCallback","returnedData","status","translatedItems","points","sort","a","i","translatedItem","poiType","type","poiIndexKey","heatPoint","count","heatArray","pointItem","lineMap","strokeColor","strokeWeight","markerArray","setGradient","gradient","colors","document","querySelectorAll","slice","call","forEach","ele","getAttribute","value","heatmapOverlay","setOptions","isSupportCanvas","elem","createElement","getContext","ZoomControl","defaultAnchor","BMAP_ANCHOR_BOTTOM_RIGHT","defaultOffset","BMapLib","HeatmapOverlay","radius","setDataSet","max","prototype","Control","initialize","myZoomCtrl","addControl","lineCount","Object","keys","lines","values","polyline","Polyline","enableEditing","enableClicking","strokeOpacity","addMarker","MarkerClusterer","sourcePointList","Array","sourceGps","sourceGpsId","convertor","translate","Convertor","setTimeout","pos","gpsList","split","gpsStr","gpsItem","assign","parseFloat","filter","o","isNil","snapshotData","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","setMapStyle","style","body","s","getElementsByTagName","len","removeChild","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","stickyLabels","scope","attrs","ctrl","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint-disable eqeqeq,id-length,no-inner-declarations,no-plusplus,no-mixed-operators */\n/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\nimport {MP} from './libs/baidumap.js';\nimport $ from 'jquery';\n\nconst panelDefaults = {\n    ak: 'QKCqsdHBbGxBnNbvUwWdUEBjonk7jUj6',\n    maxDataPoints: 1,\n    theme: 'normal',\n    lat: 39.968539,\n    lng: 116.497856,\n    initialZoom: 14,\n    valueName: 'current',\n    locationData: 'table',\n    gpsType: '百度坐标系',\n    esMetric: 'Count',\n    decimals: 0,\n    navigation: true,\n    scale: true,\n    hideEmpty: false,\n    overviewMap: false,\n    hideZero: false,\n    mapType: true\n};\n\n\nfunction getPoiExt(poiConfig, configName, defaultValue = '') {\n    if ('ext' in poiConfig && poiConfig.ext.length > 0) {\n        const extJson = JSON.parse(poiConfig.ext);\n        if (configName in extJson) {\n            return extJson[configName];\n        }\n    }\n    return defaultValue;\n}\n\nfunction getColor(orginBili, alpha) {\n    const bili = orginBili > 100 ? 100 : orginBili;\n    // 百分之一 = (单色值范围) / 50;  单颜色的变化范围只在50%之内\n    const one = (255 + 255) / 100;\n    let r = 0;\n    let g = 0;\n    let b = 0;\n\n    const yellowValue = 50;\n    const fullRedValue = 95;\n    const darkRedWeight = 0.6;\n\n    if (bili <= yellowValue) {\n        // 比例小于yellowValue的时候红色是越来越多的,直到红色为255时(红+绿)变为黄色.\n        r = one * bili / yellowValue * 50;\n        g = 255;\n    } else if (bili > yellowValue && bili <= fullRedValue) {\n        // 比例大于yellowValue的时候绿色是越来越少的,直到fullRedValue 变为纯红\n        g = 255 - ((bili - yellowValue) / (fullRedValue - yellowValue) * 50 * one);\n        r = 255;\n    } else {\n        // 比例大于fullRedValue 开始转为暗红\n        g = 0;\n        r = 255 * (1 - darkRedWeight * (bili - fullRedValue) / (100 - fullRedValue));\n    }\n    r = parseInt(r, 10);// 取整\n    g = parseInt(g, 10);// 取整\n    b = parseInt(b, 10);// 取整\n    return 'rgb(' + r + ',' + g + ',' + b + ',' + alpha + ')';\n}\n\n// 获取色块对应的矩形相对于地图的像素值\nfunction getDotRect(_this, lng, lat, squareSize = 20, isCenterPoint = true) {\n    const standardLen = 111700;\n    const xScale = Math.cos(lat * Math.PI / 180);\n    const lngDelta = squareSize / (standardLen * xScale);\n    const latDelta = squareSize / (standardLen);\n\n    const pixel = _this.map.pointToPixel(isCenterPoint ? new window.BMap.Point(lng + lngDelta / 2, lat + latDelta / 2) : new window.BMap.Point(lng, lat));\n    const pixel2 = _this.map.pointToPixel(isCenterPoint ? new window.BMap.Point(lng - lngDelta / 2, lat - latDelta / 2) : new window.BMap.Point(lng + lngDelta, lat + latDelta));\n    return {\n        x: pixel.x,\n        y: pixel.y,\n        w: pixel2.x - pixel.x,\n        h: pixel2.y - pixel.y,\n    };\n}\n\n\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector, contextSrv) {\n        super($scope, $injector);\n        this.setMapProvider(contextSrv);\n        _.defaults(this.panel, panelDefaults);\n\n        this.dataFormatter = new DataFormatter(this, kbn);\n        this.markers = [];\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n        // this.loadLocationDataFromFile();\n    }\n\n    setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n        this.tileServer = 'CartoDB Positron';\n        this.setMapSaturationClass();\n    }\n\n    setMapSaturationClass() {\n        if (this.tileServer === 'CartoDB Dark') {\n            this.saturationClass = 'map-darken';\n        } else {\n            this.saturationClass = '';\n        }\n    }\n\n    loadLocationDataFromFile(reload) {\n        if (this.map && !reload) return;\n\n        if (this.panel.snapshotLocationData) {\n            this.locations = this.panel.snapshotLocationData;\n            return;\n        }\n\n        if (this.panel.locationData === 'jsonp endpoint') {\n\n        } else if (this.panel.locationData === 'json endpoint') {\n            if (!this.panel.jsonUrl) return;\n        } else if (this.panel.locationData === 'table') {\n            // .. Do nothing\n\n        } else if (this.panel.locationData !== 'geohash' && this.panel.locationData !== 'json result') {\n\n        }\n    }\n\n    reloadLocations(res) {\n        this.locations = res;\n        this.refresh();\n    }\n\n    onPanelTeardown() {\n        if (this.map) delete this.map;\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n    }\n\n    onDataReceived(dataList) {\n        if (!dataList) return;\n        if (this.dashboard.snapshot && this.locations) {\n            this.panel.snapshotLocationData = this.locations;\n        }\n\n        const data = [];\n        if (this.panel.locationData === 'geohash') {\n            this.dataFormatter.setGeohashValues(dataList, data);\n        } else if (this.panel.locationData === 'table') {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else if (this.panel.locationData === 'json result') {\n            const tableData = dataList.map(DataFormatter.tableHandlers.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        }\n        // const datas = this.filterEmptyAndZeroValues(data);\n\n        const datas = data;\n        if (typeof this.data === 'object') this.data.splice(0, this.data.length);\n        this.markers.splice(0, this.markers.length);\n        if (datas.length) {\n            this.data = datas;\n\n            this.map ? this.addNode(this.BMap) : this.render();\n        } else {\n            if (this.map) this.map.clearOverlays();\n            this.render();\n        }\n    }\n\n    addMarker(point, BMap, data) {\n        const myIcon = new BMap.Icon(getPoiExt(data, 'icon', 'public/plugins/grafana-baidumap-panel/images/bike.png'), new window.BMap.Size(24, 28), {\n            imageSize: new window.BMap.Size(24, 28),\n            anchor: new window.BMap.Size(12, 28)\n        });\n\n        const marker = new BMap.Marker(point, {icon: myIcon});\n\n        this.markers.push(marker);\n\n        // this.map.setViewport(pointArray);\n        marker.enableDragging();\n        let scontent = '';\n        scontent += '<a href=\"\"><div class=\"infobox\" id=\"infobox\"><div class=\"infobox-content\" style=\"display:block\">';\n        scontent += '<div class=\"infobox-header\"><div class=\"infobox-header-icon\"><img src=\"' + getPoiExt(data, 'detail-icon', 'public/plugins/grafana-baidumap-panel/images/bike.png') + '\"></div>';\n        scontent += '<div class=\"infobox-header-name\"><p>' + getPoiExt(data, 'name') + '</p></div>';\n        scontent += '<div class=\"infobox-header-type\" style=\"min-width:250px\"><p>' + getPoiExt(data, 'type') + '</p></div></div>';\n        scontent += '<div class=\"infobox-footer\">' + getPoiExt(data, 'desc') + '</div>';\n        scontent += '<div class=\"infobox-footer-right\"></div></div><div class=\"arrow\"></div></div></a>';\n\n        const infoWindow = new BMap.InfoWindow(scontent); // 创建信息窗口对象\n        marker.addEventListener('click', function () {\n            this.map.openInfoWindow(infoWindow, point); // 开启信息窗口\n        });\n\n        this.map.addOverlay(marker);\n        marker.addEventListener('dragend', function (e) {\n            point = new BMap.Point(e.point.lng, e.point.lat);\n            alert('当前位置：' + e.point.lng + ', ' + e.point.lat);\n        });\n    }\n\n    addNode(BMap) {\n        const that = this;\n        const poiList = this.data;\n        this.map.clearOverlays();\n        console.log(poiList);\n        if (poiList) {\n            const lineMap = [];\n            const heatArray = [];\n            const markerArray = [];\n            const convertor = new BMap.Convertor();\n\n            let rawLength = 0;\n            const translatedItems = [];\n\n            for (let i = 0; i < poiList.length; i++) {\n                setTimeout((function (poiIndex) {\n                    return function () {\n                        if (poiList[poiIndex].pos && poiList[poiIndex].pos.length > 0) {\n                            const gpsList = poiList[poiIndex].pos.split(';');\n                            for (let gpsIndex = 0; gpsIndex < gpsList.length; gpsIndex++) {\n                                const gpsStr = gpsList[gpsIndex];\n                                const [lng, lat] = gpsStr.split('|');\n                                const gpsItem = Object.assign({}, poiList[poiIndex]);\n                                gpsItem.lng = parseFloat(lng);\n                                gpsItem.lat = parseFloat(lat);\n                                translateOne(poiIndex, gpsIndex, gpsItem, BMap);\n                            }\n                        }\n                    };\n                }(i)), i * 10);\n            }\n\n            function translateOne(poiIndex, gpsIndex, gps, BMap) {\n                rawLength += 1;\n\n                function translateCallback(returnedData) {\n                    if (returnedData.status == 0) {\n                        translatedItems.push({\n                            poiIndex: poiIndex,\n                            gpsIndex: gpsIndex,\n                            point: returnedData.points[0],\n                            gps: gps,\n                        });\n\n                        if (translatedItems.length == rawLength) {\n                            translatedItems.sort(function (a, b) {\n                                return ((a.poiIndex - b.poiIndex) * 1000000) + (a.gpsIndex - b.gpsIndex);\n                            });\n                            for (let i = 0; i < translatedItems.length; i++) {\n                                const translatedItem = translatedItems[i];\n                                const poiType = translatedItem.gps.type;\n                                const poiIndexKey = 'key_' + translatedItem.poiIndex;\n                                if (poiType === 'heat') {\n                                    const heatPoint = {\n                                        lng: translatedItem.point.lng,\n                                        lat: translatedItem.point.lat,\n                                        count: getPoiExt(translatedItem.gps, 'count', 1)\n                                    };\n                                    heatArray.push(heatPoint);\n                                } else if (poiType === 'line' || poiType === 'polygon') {\n                                    const pointItem = translatedItem.point;\n                                    if (poiIndexKey in lineMap) {\n                                        lineMap[poiIndexKey].points.push(pointItem);\n                                    } else {\n                                        lineMap[poiIndexKey] = {\n                                            poiType: poiType,\n                                            strokeColor: getPoiExt(translatedItem.gps, 'strokeColor', 'blue'),\n                                            strokeWeight: getPoiExt(translatedItem.gps, 'strokeWeight', '4'),\n                                            points: [pointItem]\n                                        };\n                                    }\n                                } else {\n                                    markerArray.push({point: translatedItem.point, data: translatedItem.gps});\n                                }\n                            }\n                            console.log('markerArray', markerArray);\n                            console.log('lineMap', lineMap);\n                            console.log('heatArray', heatArray);\n\n                            if (heatArray.length > 0) {\n                                // 热力图\n                                if (!isSupportCanvas()) {\n                                    alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~');\n                                }\n                                // http://xcx1024.com/ArtInfo/271881.html\n                                const heatmapOverlay = new BMapLib.HeatmapOverlay({radius: 20});\n                                that.map.addOverlay(heatmapOverlay);\n                                heatmapOverlay.setDataSet({data: heatArray, max: 100});\n\n                                function setGradient() {\n                                    const gradient = {};\n                                    let colors = document.querySelectorAll('input[type=\\'color\\']');\n                                    colors = [].slice.call(colors, 0);\n                                    colors.forEach(function (ele) {\n                                        gradient[ele.getAttribute('data-key')] = ele.value;\n                                    });\n                                    heatmapOverlay.setOptions({gradient: gradient});\n                                }\n\n                                // 判断浏览区是否支持canvas\n                                function isSupportCanvas() {\n                                    const elem = document.createElement('canvas');\n                                    return !!(elem.getContext && elem.getContext('2d'));\n                                }\n\n                                function ZoomControl() {\n                                    // 默认停靠位置和偏移量\n                                    this.defaultAnchor = BMAP_ANCHOR_BOTTOM_RIGHT;\n                                    this.defaultOffset = new BMap.Size(10, 10);\n                                }\n\n                                ZoomControl.prototype = new BMap.Control();\n                                ZoomControl.prototype.initialize = function (map) {\n                                    // let div = document.createElement('div');\n                                    // let content = '<div id=\"heatmap_mark\"><div><span class=\"heatmap_mark_title\">颜色对应RSSI信号强度</span> <span class=\"heatmap_mark_text\" style=\"float:right;padding-top:5px\" id=\"heatmap_mark_density\">dBm</span></div><div class=\"linear_color\"></div><span class=\"heatmap_blue heatmap_mark_text heatmap_color_span\">-60以下</span><span class=\"heatmap_green heatmap_mark_text heatmap_color_span\">-60至-80</span><span class=\"heatmap_yellow heatmap_mark_text heatmap_color_span\">-80至-100</span><span class=\"heatmap_red heatmap_mark_text heatmap_color_span\">-100至-120</span><span class=\"heatmap_result_red heatmap_mark_text heatmap_color_span\">-120以上</span></div>';\n                                    // div.innerHTML = content;\n                                    //\n                                    // that.map.getContainer()\n                                    //   .appendChild(div);\n                                    // return div;\n                                };\n\n                                const myZoomCtrl = new ZoomControl();\n                                // eslint-disable-next-line eqeqeq\n                                that.map.addControl(myZoomCtrl);\n                                // eslint-disable-next-line eqeqeq\n                            }\n                            const lineCount = Object.keys(lineMap).length;\n                            if (lineCount > 0) {\n                                for (let i = 0; i < lineCount; i++) {\n                                    const lines = Object.values(lineMap)[i];\n                                    const strokeColor = lines.strokeColor;\n                                    const strokeWeight = lines.strokeWeight;\n                                    if (lines.poiType === 'polygon') {\n                                        lines.points.push(lines.points[0]);\n                                    }\n                                    const polyline = new BMap.Polyline(lines.points, {\n                                        enableEditing: false,\n                                        enableClicking: true,\n                                        strokeWeight: strokeWeight,\n                                        strokeOpacity: 0.5,\n                                        strokeColor: strokeColor\n                                    });\n                                    that.map.addOverlay(polyline);\n                                }\n                            }\n                            if (markerArray.length > 0) {\n                                for (let i = 0; i < markerArray.length; i++) {\n                                    that.addMarker(markerArray[i].point, BMap, markerArray[i].data);\n                                }\n                                new BMapLib.MarkerClusterer(that.map, {\n                                    markers: that.markers\n                                });\n                            }\n                        }\n                    } else {\n                        console.log('转换出错: ' + returnedData.status);\n                    }\n                }\n\n                // 转换坐标\n                const point = new BMap.Point(gps.lng, gps.lat);\n                const sourcePointList = new Array(point);\n                const sourceGps = that.panel.gpsType;\n                let sourceGpsId = 5;\n                if (sourceGps === 'WGS84') {\n                    sourceGpsId = 1;\n                } else if (sourceGps === 'GCJ02') {\n                    sourceGpsId = 3;\n                }\n                if (sourceGpsId !== 5) {\n                    convertor.translate(sourcePointList, sourceGpsId, 5, translateCallback);\n                } else { // 不转换 直接返回\n                    translateCallback({\n                        status: 0,\n                        points: sourcePointList\n                    });\n                }\n            }\n        }\n    }\n\n    filterEmptyAndZeroValues(data) {\n        return _.filter(data, (o) => {\n            return !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n        });\n    }\n\n    onDataSnapshotLoad(snapshotData) {\n        this.onDataReceived(snapshotData);\n    }\n\n    seriesHandler(seriesData) {\n        const series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target,\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n        return series;\n    }\n\n    setNewMapCenter() {\n        this.render();\n    }\n\n    setZoom() {\n        this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n    }\n\n    setStyle() {\n        this.map.setMapStyle({style: this.panel.theme});\n    }\n\n    setAK() {\n        const x = document.body;\n        const s = document.getElementsByTagName('script');\n        const len = s.length;\n        x.removeChild(s[len - 1]);\n        delete this.map;\n        this.render();\n    }\n\n    navigationControl() {\n        if (this.panel.navigation == true) {\n            this.map.addControl(this.navigationSwitch);\n        } else {\n            this.map.removeControl(this.navigationSwitch);\n        }\n    }\n\n    scaleControl() {\n        if (this.panel.scale == true) {\n            this.map.addControl(this.scaleSwitch);\n        } else {\n            this.map.removeControl(this.scaleSwitch);\n        }\n    }\n\n    overviewMapControl() {\n        if (this.panel.overviewMap == true) {\n            this.map.addControl(this.overviewMapSwitch);\n        } else {\n            this.map.removeControl(this.overviewMapSwitch);\n        }\n    }\n\n    mapTypeControl() {\n        if (this.panel.mapType == true) {\n            this.map.addControl(this.mapTypeSwitch);\n        } else {\n            this.map.removeControl(this.mapTypeSwitch);\n        }\n    }\n\n    resize() {\n\n    }\n\n    toggleStickyLabels() {\n        console.log(this.panel.stickyLabels);\n    }\n\n    changeLocationData() {\n        if (this.panel.locationData === 'geohash') {\n            this.render();\n        }\n    }\n\n    /* eslint class-methods-use-this: 0 */\n    link(scope, elem, attrs, ctrl) {\n        mapRenderer(scope, elem, attrs, ctrl);\n    }\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}