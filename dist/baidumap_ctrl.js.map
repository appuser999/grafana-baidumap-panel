{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["getColor","orginBili","alpha","bili","one","r","g","b","yellowValue","fullRedValue","darkRedWeight","parseInt","getFilterColor","originOption","styleOption","forEach","keyName","Object","assign","filterCtx","ctx","usePolyOption","sourceOption","getDefaultPolyOption","keyMap","sourceName","targetName","keyValue","getDotRect","mp","lng","lat","squareSize","isCenterPoint","standardLen","xScale","Math","cos","PI","lngDelta","latDelta","pixel","pointToPixel","window","BMap","Point","pixel2","x","y","w","h","strokeWeight","strokeOpacity","strokeColor","fillColor","fillOpacity","isPointInCircle","checkPixel","circlePixel","circleRadius","isPointInRect","checkRect","isPointInPoly","polyPoints","isIn","i","l","length","j","MetricsPanelCtrl","TimeSeries","kbn","_","mapRenderer","DataFormatter","decodeGeoHash","panelDefaults","ak","maxDataPoints","theme","initialZoom","valueName","locationData","gpsType","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","traffic","clusterPoint","globalConfig","typeName","lngName","latName","posName","geohashName","configName","contentName","enableMapClick","maskColor","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","poiType","getPoiOption","poiConfig","defaultValue","typeOption","getPoiTypeConfig","poiOption","getPoiConfig","poiItem","configKey","extJson","JSON","parse","tileServer","setMapSaturationClass","saturationClass","reload","map","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","data","setGeohashValues","tableData","tableHandler","setTableValues","tableHandlers","datas","splice","addNode","render","clearOverlays","point","defaultContent","that","e","clickPoint","infoWindow","InfoWindow","getPoiContent","openInfoWindow","markerOption","iconUrl","Number","isInteger","icon","Icon","Size","offset","imageOffset","imageSize","anchor","marker","Marker","pointLabel","label","Label","setLabel","push","enableDragging","addEventListener","getPoiInfoWindowHandler","addOverlay","setAnimation","BMAP_ANIMATION_BOUNCE","alert","poiList","clickHandler","console","log","getMapSourceId","sourceGps","sourceGpsId","translateOne","poiIndex","gpsIndex","gps","rawLength","setTimeout","translateCallback","sourcePointList","callbackList","myPoiIndex","myGpsIndex","myGps","translatedData","translatedItems","sort","a","translateIndex","pointTypeName","translatedItem","poiIndexKey","pointItem","shapeMap","shapeList","points","poiData","pointArray","v","pointCollection","PointCollection","getPoiTypeOption","heatPoiType","heatShapeList","heatmapOverlay","BMapLib","HeatmapOverlay","radius","count","setDataSet","max","labelTypeName","labelArray","labelText","labelItem","position","enableMassClear","setStyle","setTitle","markerTypeName","markerArray","addMarker","MarkerClusterer","item","pointIndex","driving","renderOptions","autoViewport","search","shape","labelPoiTypes","linePoiTypes","dotPoiTypes","canvasTypes","canvasLayerUpdater","canvasLayer","canvas","getContext","matchItems","save","clearRect","width","height","beginPath","fillStyle","fillRect","closePath","restore","isCircle","isPoint","layerItem","size","posRect","parseFloat","arc","rect","stroke","fill","startPoint","moveTo","linePoint","lineTo","globalAlpha","labelPoint","fillText","canvasLayerPointChecker","checkPoint","p","some","canvasType","CanvasLayer","paneName","zIndex","update","event","matchItem","gpsItem","longitude","latitude","gpsList","split","gpsStr","convertor","Convertor","groupSize","groupIndex","pointList","translate","result","status","index","error","filter","o","isNil","value","snapshotData","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","setMapStyle","style","document","body","s","getElementsByTagName","len","removeChild","addControl","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","trafficSwitch","stickyLabels","scope","elem","attrs","ctrl","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint-disable eqeqeq,id-length,no-inner-declarations,no-plusplus,no-mixed-operators,no-continue,no-nested-ternary */\n/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\n\nimport decodeGeoHash from './geohash';\n\nconst panelDefaults = {\n    ak: 'QKCqsdHBbGxBnNbvUwWdUEBjonk7jUj6',\n    maxDataPoints: 1,\n    theme: 'normal',\n    lat: 39.968539,\n    lng: 116.497856,\n    initialZoom: 14,\n    valueName: 'current',\n    locationData: 'json result',\n    gpsType: '百度坐标系',\n    esMetric: 'Count',\n    decimals: 0,\n    navigation: true,\n    scale: true,\n    hideEmpty: false,\n    overviewMap: false,\n    hideZero: false,\n    mapType: false,\n    traffic: false,\n    clusterPoint: false,\n    globalConfig: '',\n    typeName: 'type',\n    lngName: 'longitude',\n    latName: 'latitude',\n    posName: 'pos',\n    geohashName: 'geohash',\n    configName: 'config',\n    contentName: 'content',\n    enableMapClick: false,\n    maskColor: ''\n};\n\n\nfunction getColor(orginBili, alpha) {\n    if ((typeof orginBili) !== 'number') {\n        return orginBili;\n    }\n    const bili = orginBili > 100 ? 100 : orginBili;\n    // 百分之一 = (单色值范围) / 50;  单颜色的变化范围只在50%之内\n    const one = (255 + 255) / 100;\n    let r = 0;\n    let g = 0;\n    let b = 0;\n\n    const yellowValue = 50;\n    const fullRedValue = 95;\n    const darkRedWeight = 0.6;\n\n    if (bili <= yellowValue) {\n        // 比例小于yellowValue的时候红色是越来越多的,直到红色为255时(红+绿)变为黄色.\n        r = one * bili / yellowValue * 50;\n        g = 255;\n    } else if (bili > yellowValue && bili <= fullRedValue) {\n        // 比例大于yellowValue的时候绿色是越来越少的,直到fullRedValue 变为纯红\n        g = 255 - ((bili - yellowValue) / (fullRedValue - yellowValue) * 50 * one);\n        r = 255;\n    } else {\n        // 比例大于fullRedValue 开始转为暗红\n        g = 0;\n        r = 255 * (1 - darkRedWeight * (bili - fullRedValue) / (100 - fullRedValue));\n    }\n    r = parseInt(r, 10);// 取整\n    g = parseInt(g, 10);// 取整\n    b = parseInt(b, 10);// 取整\n    return 'rgb(' + r + ',' + g + ',' + b + ',' + alpha + ')';\n}\n\nfunction getFilterColor(originOption) {\n    const styleOption = {};\n    ['fillColor', 'strokeColor'].forEach((keyName) => {\n        if (originOption[keyName]) {\n            styleOption[keyName] = getColor(originOption[keyName], 0.5);\n        }\n    });\n    return Object.assign({}, originOption, styleOption);\n}\n\nfunction filterCtx(ctx, originOption, usePolyOption = true) {\n    const sourceOption = Object.assign(usePolyOption ? getDefaultPolyOption() : {}, originOption);\n    const styleOption = getFilterColor(sourceOption);\n    [\n        ['strokeWeight', 'lineWidth'],\n        ['fillColor', 'fillStyle'],\n        ['strokeColor', 'strokeStyle'],\n        ['strokeOpacity', 'globalAlpha'],\n    ].forEach((keyMap) => {\n        const [sourceName, targetName] = keyMap;\n        const keyValue = styleOption[sourceName];\n        delete styleOption[sourceName];\n        styleOption[targetName] = keyValue;\n    });\n    Object.assign(ctx, styleOption);\n}\n\n// 获取色块对应的矩形相对于地图的像素值\nfunction getDotRect(mp, lng, lat, squareSize = 20, isCenterPoint = true) {\n    const standardLen = 111700;\n    const xScale = Math.cos(lat * Math.PI / 180);\n    const lngDelta = squareSize / (standardLen * xScale);\n    const latDelta = squareSize / (standardLen);\n\n    const pixel = mp.pointToPixel(isCenterPoint ? new window.BMap.Point(lng - lngDelta / 2, lat - latDelta / 2) : new window.BMap.Point(lng, lat));\n    const pixel2 = mp.pointToPixel(isCenterPoint ? new window.BMap.Point(lng + lngDelta / 2, lat + latDelta / 2) : new window.BMap.Point(lng + lngDelta, lat + latDelta));\n    return {\n        x: pixel.x,\n        y: pixel.y,\n        w: pixel2.x - pixel.x,\n        h: pixel2.y - pixel.y,\n    };\n}\n\n\nfunction getDefaultPolyOption() {\n    return {\n        strokeWeight: 3,\n        strokeOpacity: 0.6,\n        strokeColor: 'blue',\n        fillColor: 'red',\n        fillOpacity: 0.4\n    };\n}\n\nfunction isPointInCircle(checkPixel, circlePixel, circleRadius) {\n    return (checkPixel.x - circlePixel.x) * (checkPixel.x - circlePixel.x)\n        + (checkPixel.y - circlePixel.y) * (checkPixel.y - circlePixel.y)\n        <= circleRadius * circleRadius\n        ;\n}\n\nfunction isPointInRect(checkPixel, checkRect) {\n    return checkPixel.x >= checkRect.x\n        && checkPixel.x <= checkRect.x + checkRect.w\n        && checkPixel.y >= checkRect.y\n        && checkPixel.y >= checkRect.y + checkRect.h;\n}\n\nfunction isPointInPoly(checkPixel, polyPoints) {\n    let isIn = false;\n    for (let isIn = false, i = -1, l = polyPoints.length, j = l - 1; ++i < l; j = i) {\n        ((polyPoints[i].y <= checkPixel.y && checkPixel.y < polyPoints[j].y) || (polyPoints[j].y <= checkPixel.y && checkPixel.y < polyPoints[i].y))\n        && (checkPixel.x < (polyPoints[j].x - polyPoints[i].x) * (checkPixel.y - polyPoints[i].y) / (polyPoints[j].y - polyPoints[i].y) + polyPoints[i].x)\n        && (isIn = !isIn);\n    }\n    return isIn;\n}\n\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n    constructor($scope, $injector, contextSrv) {\n        super($scope, $injector);\n        this.setMapProvider(contextSrv);\n        _.defaults(this.panel, panelDefaults);\n\n        this.dataFormatter = new DataFormatter(this, kbn);\n        this.markers = [];\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n        this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n        // this.loadLocationDataFromFile();\n    }\n\n    getPoiTypeOption(poiType) {\n        return this.getPoiOption(poiType, null);\n    }\n\n    getPoiOption(poiType, poiConfig, defaultValue = {}) {\n        const configName = 'option';\n        const typeOption = this.getPoiTypeConfig(poiType, configName, {});\n        const poiOption = this.getPoiConfig(poiType, poiConfig, configName, {});\n        return Object.assign(defaultValue, typeOption, poiOption);\n    }\n\n    getPoiTypeConfig(poiType, configName, defaultValue = '') {\n        return this.getPoiConfig(poiType, null, configName, defaultValue);\n    }\n\n    getPoiContent(poiType, poiItem, defaultValue = '') {\n        const contentName = this.panel.contentName;\n        if (poiItem && contentName in poiItem && poiItem[contentName].length > 0) {\n            return poiItem[contentName];\n        }\n        return this.getPoiConfig(poiType, poiItem, contentName, defaultValue);\n    }\n\n    getPoiConfig(poiType, poiItem, configKey, defaultValue = '') {\n        if (!poiType) {\n            return defaultValue;\n        }\n        const configName = this.panel.configName;\n        if (poiItem && configName in poiItem && poiItem[configName].length > 0) {\n            const extJson = JSON.parse(poiItem[configName]);\n            if (configKey in extJson) {\n                return extJson[configKey];\n            }\n        }\n        if (this.panel.globalConfig && this.panel.globalConfig.length > 0) {\n            const globalConfig = JSON.parse(this.panel.globalConfig);\n            if (poiType in globalConfig && configKey in globalConfig[poiType]) {\n                return globalConfig[poiType][configKey];\n            }\n        }\n        return defaultValue;\n    }\n\n    setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n        this.tileServer = 'CartoDB Positron';\n        this.setMapSaturationClass();\n    }\n\n    setMapSaturationClass() {\n        if (this.tileServer === 'CartoDB Dark') {\n            this.saturationClass = 'map-darken';\n        } else {\n            this.saturationClass = '';\n        }\n    }\n\n    loadLocationDataFromFile(reload) {\n        if (this.map && !reload) return;\n\n        if (this.panel.snapshotLocationData) {\n            this.locations = this.panel.snapshotLocationData;\n            return;\n        }\n\n        if (this.panel.locationData === 'jsonp endpoint') {\n\n        } else if (this.panel.locationData === 'json endpoint') {\n            if (!this.panel.jsonUrl) return;\n        } else if (this.panel.locationData === 'table') {\n            // .. Do nothing\n\n        } else if (this.panel.locationData !== 'geohash' && this.panel.locationData !== 'json result') {\n\n        }\n    }\n\n    reloadLocations(res) {\n        this.locations = res;\n        this.refresh();\n    }\n\n    onPanelTeardown() {\n        if (this.map) delete this.map;\n    }\n\n    onInitEditMode() {\n        this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n    }\n\n    onDataReceived(dataList) {\n        if (!dataList) return;\n        if (this.dashboard.snapshot && this.locations) {\n            this.panel.snapshotLocationData = this.locations;\n        }\n\n        const data = [];\n        if (this.panel.locationData === 'geohash') {\n            this.dataFormatter.setGeohashValues(dataList, data);\n        } else if (this.panel.locationData === 'table') {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else if (this.panel.locationData === 'json result') {\n            const tableData = dataList.map(DataFormatter.tableHandlers.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        } else {\n            const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n            this.dataFormatter.setTableValues(tableData, data);\n        }\n        // const datas = this.filterEmptyAndZeroValues(data);\n\n        const datas = data;\n        if (typeof this.data === 'object') this.data.splice(0, this.data.length);\n        this.markers.splice(0, this.markers.length);\n        if (datas.length) {\n            this.data = datas;\n            this.map ? this.addNode(this.BMap) : this.render();\n        } else {\n            if (this.map) this.map.clearOverlays();\n            this.render();\n        }\n    }\n\n    getPoiInfoWindowHandler(poiType, point, poiItem, defaultContent = '') {\n        const that = this;\n        return (e) => {\n            let clickPoint = point;\n            if (!clickPoint) {\n                clickPoint = e.point;\n            }\n            const infoWindow = new BMap.InfoWindow(that.getPoiContent(poiType, poiItem, defaultContent),\n                that.getPoiConfig(poiType, poiItem, 'contentOption', {\n                    'title': that.getPoiConfig(poiType, poiItem, 'title', clickPoint.lng + '|' + clickPoint.lat)\n                })\n            ); // 创建信息窗口对象\n            that.map.openInfoWindow(infoWindow, clickPoint);\n        };\n    }\n\n    addMarker(poiType, point, BMap, data) {\n\n        // public/plugins/grafana-baidumap-panel/images/bike.png\n        const markerOption = this.getPoiOption(poiType, data);\n        const iconUrl = this.getPoiConfig(poiType, data, 'icon', '');\n        if (Number.isInteger(iconUrl)) {\n            markerOption.icon = new BMap.Icon('http://api.map.baidu.com/img/markers.png', new BMap.Size(23, 25), {\n                offset: new BMap.Size(10, 25), // 指定定位位置\n                imageOffset: new BMap.Size(0, 25 * (10 - (iconUrl % 10)) - 10 * 25) // 设置图片偏移\n            });\n        } else if (iconUrl.length > 0) {\n            markerOption.icon = new BMap.Icon(iconUrl, new window.BMap.Size(24, 28), {\n                imageSize: new window.BMap.Size(24, 28),\n                anchor: new window.BMap.Size(12, 28)\n            });\n        }\n        const marker = new BMap.Marker(point, markerOption);\n        const pointLabel = this.getPoiConfig(poiType, data, 'label', '');\n        if (pointLabel.length > 0) {\n            const label = new BMap.Label(pointLabel, {offset: new BMap.Size(20, -10)});\n            marker.setLabel(label);\n        }\n        this.markers.push(marker);\n\n        // this.map.setViewport(pointArray);\n        if (this.getPoiConfig(poiType, data, 'enableDragging', false)) {\n            marker.enableDragging();\n        }\n        marker.addEventListener('click', this.getPoiInfoWindowHandler(poiType, point, data));\n\n        this.map.addOverlay(marker);\n        if (this.getPoiConfig(poiType, data, 'animation', false)) {\n            marker.setAnimation(BMAP_ANIMATION_BOUNCE); // 跳动的动画\n        }\n        marker.addEventListener('dragend', function (e) {\n            alert('当前位置：' + e.point.lng + ', ' + e.point.lat);\n        });\n    }\n\n    addNode(BMap) {\n        const that = this;\n        const poiList = this.data;\n        this.map.clearOverlays();\n        this.clickHandler = [];\n        console.log(poiList);\n        if (poiList) {\n            const shapeMap = [];\n            const sourcePointList = [];\n            const callbackList = [];\n\n            let rawLength = 0;\n            const translatedItems = [];\n\n            for (let i = 0; i < poiList.length; i++) {\n                const poiIndex = i;\n                setTimeout(function () {\n                    if (poiList[poiIndex] && poiList[poiIndex][that.panel.lngName]\n                        && poiList[poiIndex][that.panel.latName]\n                        && poiList[poiIndex][that.panel.lngName] > 0\n                        && poiList[poiIndex][that.panel.latName] > 0\n                    ) {\n                        const gpsItem = Object.assign({}, poiList[poiIndex]);\n                        gpsItem.lng = parseFloat(poiList[poiIndex][that.panel.lngName]);\n                        gpsItem.lat = parseFloat(poiList[poiIndex][that.panel.latName]);\n                        translateOne(poiIndex, 0, gpsItem, BMap);\n                    } else if (poiList[poiIndex][that.panel.geohashName] && poiList[poiIndex][that.panel.geohashName].length > 0) {\n                        const {longitude: lng, latitude: lat} = decodeGeoHash(poiList[poiIndex][that.panel.geohashName]);\n                        const gpsItem = Object.assign({}, poiList[poiIndex], {lng, lat});\n                        translateOne(poiIndex, 0, gpsItem, BMap);\n                    } else if (poiList[poiIndex][that.panel.posName] && poiList[poiIndex][that.panel.posName].length > 0) {\n                        const gpsList = poiList[poiIndex][that.panel.posName].split(';');\n                        for (let gpsIndex = 0; gpsIndex < gpsList.length; gpsIndex++) {\n                            const gpsStr = gpsList[gpsIndex];\n                            const [lng, lat] = gpsStr.split('|');\n                            const gpsItem = Object.assign({}, poiList[poiIndex]);\n                            gpsItem.lng = parseFloat(lng);\n                            gpsItem.lat = parseFloat(lat);\n                            translateOne(poiIndex, gpsIndex, gpsItem, BMap);\n                        }\n                    }\n                    if (sourcePointList.length > 0) {\n                        const convertor = new BMap.Convertor();\n                        const groupSize = 10;\n                        for (let groupIndex = 0; groupIndex < sourcePointList.length; groupIndex += groupSize) {\n                            const pointList = [];\n                            for (let pointIndex = 0; pointIndex < groupSize && pointIndex + groupIndex < sourcePointList.length; pointIndex++) {\n                                pointList.push(sourcePointList[groupIndex + pointIndex]);\n                            }\n                            convertor.translate(pointList, getMapSourceId(), 5, (result) => {\n                                if (result.status === 0) {\n                                    for (let index = 0; index < result.points.length; index++) {\n                                        callbackList[groupIndex + index](result.points[index]);\n                                    }\n                                } else {\n                                    console.error('gps translate error', pointList);\n                                }\n                            });\n                        }\n                    }\n                }, 10);\n            }\n\n            function getMapSourceId() {\n                const sourceGps = that.panel.gpsType;\n                let sourceGpsId = 5;\n                if (sourceGps === 'WGS84') {\n                    sourceGpsId = 1;\n                } else if (sourceGps === 'GCJ02') {\n                    sourceGpsId = 3;\n                }\n                return sourceGpsId;\n            }\n\n            function translateOne(poiIndex, gpsIndex, gps) {\n                rawLength += 1;\n                // 转换坐标\n                const sourceGpsId = getMapSourceId();\n                if (sourceGpsId === 5) {\n                    setTimeout(function () {\n                        translateCallback(poiIndex, gpsIndex, gps, {lng: gps.lng, lat: gps.lat});\n                    }, 1);\n                } else {\n                    const point = new BMap.Point(gps.lng, gps.lat);\n                    sourcePointList.push(point);\n                    callbackList.push(translateCallback.bind(this, poiIndex, gpsIndex, gps));\n                }\n            }\n\n            function translateCallback(myPoiIndex, myGpsIndex, myGps, translatedData) {\n                const {lng, lat} = translatedData;\n                translatedItems.push({\n                    poiIndex: myPoiIndex,\n                    gpsIndex: myGpsIndex,\n                    point: new BMap.Point(lng, lat),\n                    gps: myGps,\n                });\n\n                if (translatedItems.length === rawLength) {\n\n                    translatedItems.sort(function (a, b) {\n                        return ((a.poiIndex - b.poiIndex) * 1000000) + (a.gpsIndex - b.gpsIndex);\n                    });\n                    for (let translateIndex = 0; translateIndex < translatedItems.length; translateIndex++) {\n                        const pointTypeName = 'point';\n\n                        const translatedItem = translatedItems[translateIndex];\n                        const poiType = translatedItem.gps[that.panel.typeName] || pointTypeName;\n\n                        const poiIndexKey = 'key_' + translatedItem.poiIndex;\n                        const pointItem = translatedItem.point;\n                        if (!(poiType in shapeMap)) {\n                            shapeMap[poiType] = [];\n                        }\n                        const shapeList = shapeMap[poiType];\n                        if (shapeList.length > 0 && shapeList[shapeList.length - 1].poiIndexKey === poiIndexKey) {\n                            shapeList[shapeList.length - 1].points.push(pointItem);\n                        } else {\n                            shapeList.push({\n                                poiIndexKey: poiIndexKey,\n                                poiType: poiType,\n                                poiData: translatedItem.gps,\n                                points: [pointItem]\n                            });\n                        }\n                    }\n                    console.log('shapeMap', shapeMap);\n\n                    const pointTypeName = 'Point';\n                    if (shapeMap[pointTypeName]) {\n                        const pointArray = shapeMap[pointTypeName];\n                        const points = [];\n                        pointArray.forEach((v) => {\n                            v.points.forEach((point) => {\n                                point.poiData = v.poiData;\n                                points.push(point);\n                            });\n                        });\n                        const pointCollection = new BMap.PointCollection(points, getFilterColor(that.getPoiTypeOption(pointTypeName)));\n                        pointCollection.addEventListener('click', (e) => {\n                            const poiData = e.point.poiData;\n                            delete e.point[poiData];\n                            that.getPoiInfoWindowHandler(pointTypeName, e.point, poiData)(e);\n                        });\n                        that.map.addOverlay(pointCollection);\n                    }\n\n                    const heatPoiType = 'Heat';\n                    if (shapeMap[heatPoiType]) {\n                        const heatShapeList = shapeMap[heatPoiType];\n                        const heatmapOverlay = new BMapLib.HeatmapOverlay(\n                            Object.assign(\n                                {\n                                    radius: 20,\n                                },\n                                that.getPoiTypeOption(heatPoiType)\n                            ));\n                        that.map.addOverlay(heatmapOverlay);\n                        const dataList = [];\n                        heatShapeList.forEach((v) => {\n                            v.points.forEach((point) => {\n                                dataList.push(({\n                                    lng: point.lng,\n                                    lat: point.lat,\n                                    count: that.getPoiConfig(heatPoiType, v.poiData, 'count', 1)\n                                }));\n                            });\n                        });\n                        heatmapOverlay.setDataSet({\n                            data: dataList,\n                            max: that.getPoiTypeConfig(heatPoiType, 'max', 100)\n                        });\n                    }\n\n                    const labelTypeName = 'Label';\n                    if (shapeMap[labelTypeName]) {\n                        const labelArray = shapeMap[labelTypeName];\n                        labelArray.forEach((v) => {\n                            v.points.forEach((point) => {\n                                const labelText = that.getPoiContent(labelTypeName, v.poiData);\n                                const labelItem = new BMap.Label(labelText, {\n                                    position: point,\n                                    enableMassClear: that.getPoiConfig(labelTypeName, v.poiData, 'enableMassClear', true)\n                                });\n                                that.map.addOverlay(labelItem);\n                                labelItem.setStyle(that.getPoiConfig(labelTypeName, v.poiData, 'style', {}));\n                                labelItem.setTitle(that.getPoiConfig(labelTypeName, v.poiData, 'title', ''));\n                                labelItem.addEventListener('click', that.getPoiInfoWindowHandler(labelTypeName, point, v.poiData));\n                                // that.addlabel(labelTypeName, label, BMap, v.poiData);\n                            });\n                        });\n                    }\n                    const markerTypeName = 'Marker';\n                    if (shapeMap[markerTypeName]) {\n                        const markerArray = shapeMap[markerTypeName];\n                        markerArray.forEach((v) => {\n                            v.points.forEach((point) => {\n                                that.addMarker(markerTypeName, point, BMap, v.poiData);\n                            });\n                        });\n                        if (that.panel.clusterPoint) {\n                            new BMapLib.MarkerClusterer(that.map, {\n                                markers: that.markers\n                            });\n                        }\n                    }\n\n                    ['RidingRoute', 'DrivingRoute', 'WalkingRoute'].forEach((poiType) => {\n                        if (poiType in shapeMap) {\n                            shapeMap[poiType].forEach((item) => {\n                                const points = item.points;\n                                for (let pointIndex = 0; pointIndex < points.length - 1; pointIndex++) {\n                                    const driving = new BMap[poiType](that.map, {\n                                        renderOptions: {\n                                            map: that.map,\n                                            autoViewport: false\n                                        }\n                                    });\n                                    driving.search(points[pointIndex], points[pointIndex + 1]);\n                                }\n                            });\n                        }\n                    });\n                    ['Polyline', 'Polygon', 'Circle'].forEach((poiType) => {\n                        if (shapeMap[poiType]) {\n                            shapeMap[poiType].forEach((item) => {\n                                const poiOption = Object.assign(\n                                    getDefaultPolyOption(),\n                                    getFilterColor(that.getPoiOption(item.poiType, item.poiData))\n                                );\n                                const circleRadius = that.getPoiConfig(item.poiType, item.poiData, 'radius', 20);\n                                if (poiType === 'Circle') {\n                                    item.points.forEach((point) => {\n                                        const shape = new BMap[poiType](point, circleRadius, poiOption);\n                                        that.map.addOverlay(shape);\n                                        shape.addEventListener('click', that.getPoiInfoWindowHandler(poiType, point, item.poiData));\n                                    });\n                                } else {\n                                    const shape = new BMap[poiType](item.points, poiOption);\n                                    that.map.addOverlay(shape);\n                                    shape.addEventListener('click', that.getPoiInfoWindowHandler(poiType, null, item.poiData));\n                                }\n                            });\n                        }\n                    });\n                    const labelPoiTypes = ['label'];\n                    const linePoiTypes = ['polyline', 'polygon'];\n                    const dotPoiTypes = ['circle', 'square', 'point'];\n                    const canvasTypes = [...labelPoiTypes, ...dotPoiTypes, ...linePoiTypes];\n\n                    const canvasLayerUpdater = (canvasLayer) => {\n                        const ctx = canvasLayer.canvas.getContext('2d');\n                        if (!ctx) {\n                            return [];\n                        }\n                        const matchItems = [];\n                        ctx.save();\n                        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                        if (that.panel.maskColor) {\n                            ctx.beginPath();\n                            ctx.fillStyle = that.panel.maskColor;\n                            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n                            ctx.closePath();\n                        }\n                        ctx.restore();\n                        dotPoiTypes.forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    item.points.forEach((point) => {\n                                        ctx.save();\n                                        const isCircle = poiType === 'circle';\n                                        const isPoint = poiType === 'point';\n                                        const layerItem = {\n                                            lng: point.lng,\n                                            lat: point.lat,\n                                            size: that.getPoiConfig(poiType, item.poiData, isCircle ? 'radius' :\n                                                (isPoint ? 'size' : 'length'), isCircle ? 10 :\n                                                (isPoint ? 5 : 20)),\n                                        };\n                                        ctx.beginPath();\n                                        filterCtx(ctx, that.getPoiOption(poiType, item.poiData, isPoint ? {\n                                            'fillColor': getColor(that.getPoiConfig(poiType, item.poiData, 'color', 'blue'), 0.4)\n                                        } : {}));\n                                        const posRect = getDotRect(that.map, parseFloat(layerItem.lng),\n                                            parseFloat(layerItem.lat), layerItem.size, !isCircle);\n                                        if (isPoint) {\n                                            ctx.arc(posRect.x, posRect.y, layerItem.size, 0, 2 * Math.PI);\n                                        } else if (isCircle) {\n                                            ctx.arc(posRect.x, posRect.y, posRect.w, 0, 2 * Math.PI);\n                                        } else {\n                                            ctx.rect(posRect.x, posRect.y, posRect.w, posRect.h);\n                                        }\n                                        ctx.closePath();\n                                        if (!isPoint) {\n                                            ctx.stroke();\n                                        }\n                                        ctx.fill();\n                                        ctx.restore();\n                                    });\n                                });\n                            }\n                        });\n                        linePoiTypes.forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    ctx.save();\n                                    ctx.beginPath();\n                                    const poiOption = that.getPoiOption(poiType, item.poiData);\n                                    filterCtx(ctx, poiOption);\n                                    const startPoint = that.map.pointToPixel(item.points[0]);\n                                    ctx.moveTo(startPoint.x, startPoint.y);\n                                    for (let pointIndex = 1; pointIndex < item.points.length; pointIndex++) {\n                                        const linePoint = that.map.pointToPixel(item.points[pointIndex]);\n                                        ctx.lineTo(linePoint.x, linePoint.y);\n                                    }\n                                    if (poiType === 'polyline') {\n                                        ctx.stroke();\n                                    } else if (poiType === 'polygon') {\n                                        ctx.closePath();\n                                        ctx.stroke();\n                                        if (poiOption.fillOpacity) {\n                                            ctx.globalAlpha = poiOption.fillOpacity;\n                                        }\n                                        ctx.fill();\n                                    }\n                                    ctx.restore();\n                                });\n                            }\n                        });\n                        labelPoiTypes.forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    ctx.save();\n                                    ctx.beginPath();\n                                    const labelText = that.getPoiContent(poiType, item.poiData);\n                                    const poiOption = that.getPoiOption(poiType, item.poiData);\n                                    filterCtx(ctx, poiOption, false);\n                                    for (let pointIndex = 0; pointIndex < item.points.length; pointIndex++) {\n                                        ctx.beginPath();\n                                        const labelPoint = that.map.pointToPixel(item.points[pointIndex]);\n                                        ctx.fillText(labelText, labelPoint.x, labelPoint.y);\n                                    }\n                                    ctx.restore();\n                                });\n                            }\n                        });\n                        return matchItems;\n                    };\n\n                    const canvasLayerPointChecker = (checkPoint) => {\n                        const checkPixel = that.map.pointToPixel(checkPoint);\n                        const matchItems = [];\n                        dotPoiTypes.forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    item.points.forEach((point) => {\n                                        const isCircle = poiType === 'circle';\n                                        const isPoint = poiType === 'point';\n                                        const layerItem = {\n                                            lng: point.lng,\n                                            lat: point.lat,\n                                            size: that.getPoiConfig(poiType, item.poiData, isCircle ? 'radius' :\n                                                (isPoint ? 'size' : 'length'), isCircle ? 10 :\n                                                (isPoint ? 5 : 20)),\n                                        };\n                                        const posRect = getDotRect(that.map, parseFloat(layerItem.lng),\n                                            parseFloat(layerItem.lat), layerItem.size, !isCircle);\n                                        if (isPoint) {\n                                            if (isPointInCircle(checkPixel, posRect, layerItem.size)) {\n                                                matchItems.push([checkPoint, poiType, item.poiData, point]);\n                                            }\n                                        } else if (isCircle) {\n                                            if (isPointInCircle(checkPixel, posRect, posRect.w)) {\n                                                matchItems.push([checkPoint, poiType, item.poiData, point]);\n                                            }\n                                        } else if (isPointInRect(checkPixel, posRect)) {\n                                            matchItems.push([checkPoint, poiType, item.poiData, point]);\n                                        }\n                                    });\n                                });\n                            }\n                        });\n                        linePoiTypes.forEach((poiType) => {\n                            if (shapeMap[poiType]) {\n                                shapeMap[poiType].forEach((item) => {\n                                    if (poiType === 'polygon'\n                                        && isPointInPoly(checkPixel, item.points.map(p => that.map.pointToPixel(p)))\n                                    ) {\n                                        matchItems.push([checkPoint, poiType, item.poiData, item.points]);\n                                    }\n                                });\n                            }\n                        });\n                        return matchItems;\n                    };\n\n                    if (canvasTypes.some(canvasType => shapeMap[canvasType]) || that.panel.maskColor) {\n                        const canvasLayer = new BMap.CanvasLayer({\n                            paneName: 'mapPane',\n                            zIndex: -999,\n                            update: function () {\n                                canvasLayerUpdater(this);\n                            }\n                        });\n                        that.map.addOverlay(canvasLayer);\n                        that.clickHandler.push((event) => {\n                            const matchItems = canvasLayerPointChecker(event.point);\n                            if (matchItems.length > 0) {\n                                const matchItem = matchItems[0];\n                                that.getPoiInfoWindowHandler(matchItem[1], event.point, matchItem[0])(event);\n                            }\n                        });\n                    }\n                }\n            }\n        }\n    }\n\n    filterEmptyAndZeroValues(data) {\n        return _.filter(data, (o) => {\n            return !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n        });\n    }\n\n    onDataSnapshotLoad(snapshotData) {\n        this.onDataReceived(snapshotData);\n    }\n\n    seriesHandler(seriesData) {\n        const series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target,\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n        return series;\n    }\n\n    setNewMapCenter() {\n        this.render();\n    }\n\n    setZoom() {\n        this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n    }\n\n    setStyle() {\n        this.map.setMapStyle({style: this.panel.theme});\n    }\n\n    setAK() {\n        const x = document.body;\n        const s = document.getElementsByTagName('script');\n        const len = s.length;\n        x.removeChild(s[len - 1]);\n        delete this.map;\n        this.render();\n    }\n\n    navigationControl() {\n        if (this.panel.navigation == true) {\n            this.map.addControl(this.navigationSwitch);\n        } else {\n            this.map.removeControl(this.navigationSwitch);\n        }\n    }\n\n    scaleControl() {\n        if (this.panel.scale == true) {\n            this.map.addControl(this.scaleSwitch);\n        } else {\n            this.map.removeControl(this.scaleSwitch);\n        }\n    }\n\n    overviewMapControl() {\n        if (this.panel.overviewMap === true) {\n            this.map.addControl(this.overviewMapSwitch);\n        } else {\n            this.map.removeControl(this.overviewMapSwitch);\n        }\n    }\n\n    mapTypeControl() {\n        if (this.panel.mapType === true) {\n            this.map.addControl(this.mapTypeSwitch);\n        } else {\n            this.map.removeControl(this.mapTypeSwitch);\n        }\n    }\n\n    trafficControl() {\n        if (this.panel.traffic === true) {\n            this.map.addControl(this.trafficSwitch);\n        } else {\n            this.map.removeControl(this.trafficSwitch);\n        }\n    }\n\n    resize() {\n\n    }\n\n    toggleStickyLabels() {\n        console.log(this.panel.stickyLabels);\n    }\n\n    changeLocationData() {\n        if (this.panel.locationData === 'geohash') {\n            this.render();\n        }\n    }\n\n    /* eslint class-methods-use-this: 0 */\n    link(scope, elem, attrs, ctrl) {\n        mapRenderer(scope, elem, attrs, ctrl);\n    }\n\n\n// 如果要调试事件接口，请打开下方屏蔽代码，\n// 在firefox或者chrome下查看调试信息\n\n    // distanceTool.addEventListener('drawend', function (e) {\n    //     console.log('drawend');\n    //     console.log(e.points);\n    //     console.log(e.overlays);\n    //     console.log(e.distance);\n    // });\n    //\n    // distanceTool.addEventListener('addpoint', function (e) {\n    //     console.log('addpoint');\n    //     console.log(e.point);\n    //     console.log(e.pixel);\n    //     console.log(e.index);\n    //     console.log(e.distance);\n    // });\n    //\n    // distanceTool.addEventListener('removepolyline', function (e) {\n    //     console.log('removepolyline');\n    //     console.log(e);\n    // });\n\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}