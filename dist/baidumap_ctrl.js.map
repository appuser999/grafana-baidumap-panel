{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["MetricsPanelCtrl","TimeSeries","kbn","_","mapRenderer","DataFormatter","MP","panelDefaults","ak","maxDataPoints","theme","lat","lng","initialZoom","valueName","locationData","icon","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","tileServer","setMapSaturationClass","saturationClass","reload","map","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","console","log","data","setGeohashValues","tableData","tableHandler","setTableValues","series","setJsonValues","datas","splice","length","addNode","BMap","render","clearOverlays","point","myIcon","Icon","Size","marker","Marker","push","markerClusterer","BMapLib","MarkerClusterer","enableDragging","info","scontent","url","label","infoWindow","InfoWindow","addEventListener","openInfoWindow","addOverlay","e","Point","alert","p1","p2","driving","DrivingRoute","renderOptions","autoViewport","search","setTimeout","pointss","count","isSupportCanvas","heatmapOverlay","HeatmapOverlay","radius","setDataSet","max","setGradient","gradient","colors","document","querySelectorAll","slice","call","forEach","ele","getAttribute","value","setOptions","elem","createElement","getContext","list","pointArray","i","addMarker","filter","o","isNil","snapshotData","seriesData","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","parseInt","setMapStyle","style","x","body","s","getElementsByTagName","len","removeChild","addControl","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","stickyLabels","scope","attrs","ctrl","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\nimport { MP } from \"./libs/baidumap.js\";  \n\nconst panelDefaults = {\n  ak: \"4AWvSkHwSEcX8nwS0bZBcFZTDw70NzZZ\",\n  maxDataPoints: 1,\n  theme: \"normal\",\n  lat: 39.915,\n  lng: 116.404,\n  initialZoom: 11,\n  valueName: \"current\",\n  locationData: \"table\",\n  icon: \"Label\",\n  esMetric: \"Count\",\n  decimals: 0,\n  navigation: true,\n  scale: true,\n  hideEmpty: false,\n  overviewMap: false,\n  hideZero: false,\n  mapType: true\n};\n\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, contextSrv) {\n    super($scope, $injector);\n\n    this.setMapProvider(contextSrv);\n    _.defaults(this.panel, panelDefaults);\n    this.dataFormatter = new DataFormatter(this, kbn);\n    this.markers = [];\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n    //this.loadLocationDataFromFile();\n  }\n\n  setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n    this.tileServer = 'CartoDB Positron';\n    this.setMapSaturationClass();\n  }\n\n  setMapSaturationClass() {\n    if (this.tileServer === 'CartoDB Dark') {\n      this.saturationClass = 'map-darken';\n    } else {\n      this.saturationClass = '';\n    }\n  }\n\n  loadLocationDataFromFile(reload) {\n    if (this.map && !reload) return;\n\n    if (this.panel.snapshotLocationData) {\n      this.locations = this.panel.snapshotLocationData;\n      return;\n    }\n\n    if (this.panel.locationData === \"jsonp endpoint\") {\n\n    } else if (this.panel.locationData === \"json endpoint\") {\n      if (!this.panel.jsonUrl) return;\n\n    } else if (this.panel.locationData === \"table\") {\n      // .. Do nothing\n\n    } else if (this.panel.locationData !== \"geohash\" && this.panel.locationData !== \"json result\") {\n\n    }\n  }\n\n  reloadLocations(res) {\n    this.locations = res;\n    this.refresh();\n  }\n\n  onPanelTeardown() {\n    if (this.map) delete this.map;\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n  }\n\n  onDataReceived(dataList) {\n    if (!dataList) return;\n    if (this.dashboard.snapshot && this.locations) {\n      this.panel.snapshotLocationData = this.locations;\n    }\n    console.log(this.panel.locationData);\n    const data = [];\n    if (this.panel.locationData === \"geohash\") {\n      this.dataFormatter.setGeohashValues(dataList, data);\n    } else if (this.panel.locationData === \"table\") {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    } else if (this.panel.locationData === \"json result\") {\n      this.series = dataList;\n      this.dataFormatter.setJsonValues(data);\n    } else {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    }\n    //const datas = this.filterEmptyAndZeroValues(data);\n    const datas = data;\n    if(typeof this.data === 'object')this.data.splice(0, this.data.length);\n    this.markers.splice(0, this.markers.length);\n    if (datas.length) {\n      this.data = datas;\n      \n      if (this.map) {\n        this.addNode(this.BMap);\n      } else {\n        this.render();\n      }\n    } else {\n      if(this.map)this.map.clearOverlays();\n      this.render();\n    }\n  }\n  \n  addMarker(point, BMap, data) {\n    const myIcon = new BMap.Icon(\"public/plugins/grafana-baidumap-panel/images/pins6-poi.png\", new BMap.Size(30, 30));\n    const marker = new BMap.Marker(point, { icon: myIcon });\n    \n    this.markers.push(marker);\n    if(this.markers.length == this.data.length){\n      const markerClusterer = new BMapLib.MarkerClusterer(this.map, {\n        markers: this.markers\n      });\n    }\n    //this.map.setViewport(pointArray);\n    marker.enableDragging();\n    console.log(data);\n    const info = '';\n    let scontent = \"\";\n    scontent += '<a href=\"' + info.url + '\"><div class=\"infobox\" id=\"infobox\"><div class=\"infobox-content\" style=\"display:block\">';\n    scontent += '<div class=\"infobox-header\"><div class=\"infobox-header-icon\"><img src=\"public/plugins/grafana-baidumap-panel/images/pins6.png\"></div>';\n    scontent += '<div class=\"infobox-header-name\"><p>ffffff100000053c</p></div>';\n    scontent += '<div class=\"infobox-header-type\" style=\"min-width:250px\"><p>' + info.label + '</p></div></div>';\n    scontent += '<div class=\"infobox-footer\">在线时间：10分钟前</div>';\n    scontent += '<div class=\"infobox-footer-right\"></div></div><div class=\"arrow\"></div></div></a>';\n\n    const infoWindow = new BMap.InfoWindow(scontent); // 创建信息窗口对象\n    marker.addEventListener(\"click\", function() {\n      this.map.openInfoWindow(infoWindow, point); //开启信息窗口\n    });\n\n    this.map.addOverlay(marker);\n    marker.addEventListener(\"dragend\", function(e) {\n      point = new BMap.Point(e.point.lng, e.point.lat);\n      alert(\"当前位置：\" + e.point.lng + \", \" + e.point.lat);\n    });\n  }\n\n  addNode(BMap) {    \n    var p1 = new BMap.Point(114.025125, 22.547656);\n    var p2 = new BMap.Point(114.053295, 22.524289);\n    var driving = new BMap.DrivingRoute(this.map, {\n      renderOptions: { map: this.map, autoViewport: true }\n    });\n    driving.search(p1, p2); \n\n    setTimeout(() => {\n      var pointss = [\n        { lng: 114.074338, lat: 22.544852, count: 1150 }, \n        { lng: 114.075338, lat: 22.545852, count: 2451 },\n        { lng: 114.076338, lat: 22.546852, count: 11150 },\n        { lng: 114.077338, lat: 22.547852, count: 450 }, \n        { lng: 114.078338, lat: 22.548852, count: 1850 }, \n        { lng: 114.079338, lat: 22.549852, count: 2450 }, \n        { lng: 114.076438, lat: 22.544862, count: 1650 }, \n        { lng: 114.076638, lat: 22.544872, count: 350 },\n        { lng: 114.080338, lat: 22.545852, count: 1150 }, \n        { lng: 114.081338, lat: 22.546852, count: 2451 },\n        { lng: 114.082338, lat: 22.547852, count: 11150 },\n        { lng: 114.083338, lat: 22.548852, count: 450 }, \n        { lng: 114.084338, lat: 22.549852, count: 1850 }, \n        { lng: 114.085338, lat: 22.549852, count: 2450 }, \n        { lng: 114.086438, lat: 22.544862, count: 1650 }, \n        { lng: 114.087638, lat: 22.544872, count: 350 }\n      ];\n\n      if (!isSupportCanvas()) {\n        alert(\"热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~\");\n      }\n      var heatmapOverlay = new BMapLib.HeatmapOverlay({ radius: 20 });\n      this.map.addOverlay(heatmapOverlay);\n      heatmapOverlay.setDataSet({ data: pointss, max: 100 });\n\n      function setGradient() {\n        /*格式如下所示:\n\t\t{\n\t  \t\t0:'rgb(102, 255, 0)',\n\t \t \t.5:'rgb(255, 170, 0)',\n\t\t  \t1:'rgb(255, 0, 0)'\n\t\t}*/\n        var gradient = {};\n        var colors = document.querySelectorAll(\"input[type='color']\");\n        colors = [].slice.call(colors, 0);\n        colors.forEach(function(ele) {\n          gradient[ele.getAttribute(\"data-key\")] = ele.value;\n        });\n        heatmapOverlay.setOptions({ gradient: gradient });\n      }\n      //判断浏览区是否支持canvas\n      function isSupportCanvas() {\n        var elem = document.createElement(\"canvas\");\n        return !!(elem.getContext && elem.getContext(\"2d\"));\n      }\n\n      const list = this.data;\n      const pointArray = [];\n      for (const i in list) {\n        const point = new BMap.Point(list[i].lng, list[i].lat);\n        this.addMarker(point, BMap, list[i]);\n      }\n    }, 500);\n  }\n\n  filterEmptyAndZeroValues(data) {\n\t\treturn _.filter(data, (o) => {\n\t\t\treturn !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n\t\t});\n\t}\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData);\n  }\n\n  seriesHandler(seriesData) {\n    const series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n    \n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n  \n  setNewMapCenter() {\n    this.render();\n  }\n\n  setZoom() {\n    this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n  }\n\n  setStyle() {\n\t\tthis.map.setMapStyle({ style: this.panel.theme });\n\t}\n\n  setAK() {\n    let x = document.body;\n    let s = document.getElementsByTagName(\"script\");\n    let len = s.length;\n    x.removeChild(s[len - 1]);\n    delete this.map;\n    this.render();\n\t}\n\n  navigationControl() {\n    if (this.panel.navigation == true) {\n      this.map.addControl(this.navigationSwitch);\n    } else {\n      this.map.removeControl(this.navigationSwitch);\n    }\n  }\n\n  scaleControl() {\n    if (this.panel.scale == true) {\n      this.map.addControl(this.scaleSwitch);\n    } else {\n      this.map.removeControl(this.scaleSwitch);\n    }\n  }\n\n  overviewMapControl() {\n    if (this.panel.overviewMap == true) {\n      this.map.addControl(this.overviewMapSwitch);\n    } else {\n      this.map.removeControl(this.overviewMapSwitch);\n    }\n  }\n\n  mapTypeControl() {\n    if (this.panel.mapType == true) {\n      this.map.addControl(this.mapTypeSwitch);\n    } else {\n      this.map.removeControl(this.mapTypeSwitch);\n    }\n  }\n\n  resize() {\n    \n  }\n\n  toggleStickyLabels() {\n    console.log(this.panel.stickyLabels);\n  }\n\n  changeLocationData() {\n    if (this.panel.locationData === 'geohash') {\n      this.render();\n    }\n  }\n\n/* eslint class-methods-use-this: 0 */\n  link(scope, elem, attrs, ctrl) {\n    mapRenderer(scope, elem, attrs, ctrl);\n  }\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}