{"version":3,"sources":["../src/baidumap_ctrl.js"],"names":["getPoiExt","poiConfig","configName","defaultValue","extJson","JSON","parse","ext","MetricsPanelCtrl","TimeSeries","kbn","_","mapRenderer","DataFormatter","MP","$","panelDefaults","ak","maxDataPoints","theme","lat","lng","initialZoom","valueName","locationData","icon","esMetric","decimals","navigation","scale","hideEmpty","overviewMap","hideZero","mapType","BaidumapCtrl","$scope","$injector","contextSrv","setMapProvider","defaults","panel","dataFormatter","markers","events","on","onInitEditMode","bind","onDataReceived","onPanelTeardown","onDataSnapshotLoad","tileServer","setMapSaturationClass","saturationClass","reload","map","snapshotLocationData","locations","jsonUrl","res","refresh","addEditorTab","dataList","dashboard","snapshot","data","setGeohashValues","tableData","tableHandler","setTableValues","tableHandlers","datas","splice","length","addNode","BMap","render","clearOverlays","point","myIcon","Icon","window","Size","imageSize","anchor","marker","Marker","push","enableDragging","scontent","infoWindow","InfoWindow","addEventListener","openInfoWindow","addOverlay","e","Point","alert","that","poiList","console","log","translateOne","poiIndex","gpsIndex","gps","rawLength","translateCallback","returnedData","status","translatedItems","points","sort","a","b","i","translatedItem","poiType","type","poiIndexKey","heatPoint","count","heatArray","pointItem","lineMap","strokeColor","strokeWeight","markerArray","setGradient","gradient","colors","document","querySelectorAll","slice","call","forEach","ele","getAttribute","value","heatmapOverlay","setOptions","isSupportCanvas","elem","createElement","getContext","ZoomControl","defaultAnchor","BMAP_ANCHOR_BOTTOM_RIGHT","defaultOffset","BMapLib","HeatmapOverlay","radius","setDataSet","max","prototype","Control","initialize","myZoomCtrl","addControl","lineCount","Object","keys","lines","values","polyline","Polyline","enableEditing","enableClicking","strokeOpacity","addMarker","MarkerClusterer","convertor","translate","Array","Convertor","setTimeout","pos","gpsList","split","gpsStr","gpsItem","assign","parseFloat","filter","o","isNil","snapshotData","seriesData","series","datapoints","alias","target","flotpairs","getFlotPairs","nullPointMode","setZoom","parseInt","setMapStyle","style","x","body","s","getElementsByTagName","len","removeChild","navigationSwitch","removeControl","scaleSwitch","overviewMapSwitch","mapTypeSwitch","stickyLabels","scope","attrs","ctrl","templateUrl"],"mappings":"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","file":"baidumap_ctrl.js","sourcesContent":["/* eslint-disable eqeqeq,id-length,no-inner-declarations,no-plusplus */\n/* eslint import/no-extraneous-dependencies: 0 */\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport TimeSeries from 'app/core/time_series2';\nimport kbn from 'app/core/utils/kbn';\n\nimport _ from 'lodash';\nimport mapRenderer from './map_renderer';\nimport DataFormatter from './data_formatter';\nimport {MP} from './libs/baidumap.js';\nimport $ from 'jquery';\n\nconst panelDefaults = {\n  ak: 'QKCqsdHBbGxBnNbvUwWdUEBjonk7jUj6',\n  maxDataPoints: 1,\n  theme: 'normal',\n  lat: 39.968539,\n  lng: 116.497856,\n  initialZoom: 14,\n  valueName: 'current',\n  locationData: 'table',\n  icon: 'Label',\n  esMetric: 'Count',\n  decimals: 0,\n  navigation: true,\n  scale: true,\n  hideEmpty: false,\n  overviewMap: false,\n  hideZero: false,\n  mapType: true\n};\n\n\nfunction getPoiExt(poiConfig, configName, defaultValue = '') {\n  if ('ext' in poiConfig) {\n    const extJson = JSON.parse(poiConfig.ext);\n    if (configName in extJson) {\n      return extJson[configName];\n    }\n  }\n  return defaultValue;\n}\n\nexport default class BaidumapCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, contextSrv) {\n    super($scope, $injector);\n    this.setMapProvider(contextSrv);\n    _.defaults(this.panel, panelDefaults);\n\n    this.dataFormatter = new DataFormatter(this, kbn);\n    this.markers = [];\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    this.events.on('data-snapshot-load', this.onDataSnapshotLoad.bind(this));\n    // this.loadLocationDataFromFile();\n  }\n\n  setMapProvider(contextSrv) {\n//    this.tileServer = contextSrv.user.lightTheme ? 'CartoDB Positron' : 'CartoDB Dark';\n    this.tileServer = 'CartoDB Positron';\n    this.setMapSaturationClass();\n  }\n\n  setMapSaturationClass() {\n    if (this.tileServer === 'CartoDB Dark') {\n      this.saturationClass = 'map-darken';\n    } else {\n      this.saturationClass = '';\n    }\n  }\n\n  loadLocationDataFromFile(reload) {\n    if (this.map && !reload) return;\n\n    if (this.panel.snapshotLocationData) {\n      this.locations = this.panel.snapshotLocationData;\n      return;\n    }\n\n    if (this.panel.locationData === 'jsonp endpoint') {\n\n    } else if (this.panel.locationData === 'json endpoint') {\n      if (!this.panel.jsonUrl) return;\n    } else if (this.panel.locationData === 'table') {\n      // .. Do nothing\n\n    } else if (this.panel.locationData !== 'geohash' && this.panel.locationData !== 'json result') {\n\n    }\n  }\n\n  reloadLocations(res) {\n    this.locations = res;\n    this.refresh();\n  }\n\n  onPanelTeardown() {\n    if (this.map) delete this.map;\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Baidumap', 'public/plugins/grafana-baidumap-panel/partials/editor.html', 2);\n  }\n\n  onDataReceived(dataList) {\n    if (!dataList) return;\n    if (this.dashboard.snapshot && this.locations) {\n      this.panel.snapshotLocationData = this.locations;\n    }\n\n    const data = [];\n    if (this.panel.locationData === 'geohash') {\n      this.dataFormatter.setGeohashValues(dataList, data);\n    } else if (this.panel.locationData === 'table') {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    } else if (this.panel.locationData === 'json result') {\n      const tableData = dataList.map(DataFormatter.tableHandlers.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    } else {\n      const tableData = dataList.map(DataFormatter.tableHandler.bind(this));\n      this.dataFormatter.setTableValues(tableData, data);\n    }\n    // const datas = this.filterEmptyAndZeroValues(data);\n\n    const datas = data;\n    if (typeof this.data === 'object') this.data.splice(0, this.data.length);\n    this.markers.splice(0, this.markers.length);\n    if (datas.length) {\n      this.data = datas;\n\n      this.map ? this.addNode(this.BMap) : this.render();\n    } else {\n      if (this.map) this.map.clearOverlays();\n      this.render();\n    }\n  }\n\n  addMarker(point, BMap, data) {\n    const myIcon = new BMap.Icon(getPoiExt(data, 'icon', 'public/plugins/grafana-baidumap-panel/images/bike.png'), new window.BMap.Size(24, 28), {\n      imageSize: new window.BMap.Size(24, 28),\n      anchor: new window.BMap.Size(12, 28)\n    });\n\n    const marker = new BMap.Marker(point, {icon: myIcon});\n\n    this.markers.push(marker);\n\n    // this.map.setViewport(pointArray);\n    marker.enableDragging();\n    let scontent = '';\n    scontent += '<a href=\"\"><div class=\"infobox\" id=\"infobox\"><div class=\"infobox-content\" style=\"display:block\">';\n    scontent += '<div class=\"infobox-header\"><div class=\"infobox-header-icon\"><img src=\"' + getPoiExt(data, 'detail-icon', 'public/plugins/grafana-baidumap-panel/images/bike.png') + '\"></div>';\n    scontent += '<div class=\"infobox-header-name\"><p>' + getPoiExt(data, 'name') + '</p></div>';\n    scontent += '<div class=\"infobox-header-type\" style=\"min-width:250px\"><p>' + getPoiExt(data, 'type') + '</p></div></div>';\n    scontent += '<div class=\"infobox-footer\">' + getPoiExt(data, 'desc') + '</div>';\n    scontent += '<div class=\"infobox-footer-right\"></div></div><div class=\"arrow\"></div></div></a>';\n\n    const infoWindow = new BMap.InfoWindow(scontent); // 创建信息窗口对象\n    marker.addEventListener('click', function () {\n      this.map.openInfoWindow(infoWindow, point); // 开启信息窗口\n    });\n\n    this.map.addOverlay(marker);\n    marker.addEventListener('dragend', function (e) {\n      point = new BMap.Point(e.point.lng, e.point.lat);\n      alert('当前位置：' + e.point.lng + ', ' + e.point.lat);\n    });\n  }\n\n  addNode(BMap) {\n    const that = this;\n    const poiList = this.data;\n    this.map.clearOverlays();\n    console.log(poiList);\n    if (poiList) {\n      const lineMap = [];\n      const heatArray = [];\n      const markerArray = [];\n      const convertor = new BMap.Convertor();\n\n      let rawLength = 0;\n      const translatedItems = [];\n\n      for (let i = 0; i < poiList.length; i++) {\n        setTimeout((function (poiIndex) {\n          return function () {\n            if (poiList[poiIndex].pos && poiList[poiIndex].pos.length > 0) {\n              const gpsList = poiList[poiIndex].pos.split(';');\n              for (let gpsIndex = 0; gpsIndex < gpsList.length; gpsIndex++) {\n                const gpsStr = gpsList[gpsIndex];\n                const [lng, lat] = gpsStr.split('|');\n                const gpsItem = Object.assign({}, poiList[poiIndex]);\n                gpsItem.lng = parseFloat(lng);\n                gpsItem.lat = parseFloat(lat);\n                translateOne(poiIndex, gpsIndex, gpsItem, BMap);\n              }\n            }\n          };\n        }(i)), i * 10);\n      }\n\n\n      function translateOne(poiIndex, gpsIndex, gps, BMap) {\n        rawLength += 1;\n\n        function translateCallback(returnedData) {\n          if (returnedData.status == 0) {\n            translatedItems.push({\n              poiIndex: poiIndex,\n              gpsIndex: gpsIndex,\n              point: returnedData.points[0],\n              gps: gps,\n            });\n\n            if (translatedItems.length == rawLength) {\n              translatedItems.sort(function (a, b) {\n                return ((a.poiIndex - b.poiIndex) * 1000000) + (a.gpsIndex - b.gpsIndex);\n              });\n              for (let i = 0; i < translatedItems.length; i++) {\n                const translatedItem = translatedItems[i];\n                const poiType = translatedItem.gps.type;\n                const poiIndexKey = 'key_' + translatedItem.poiIndex;\n                if (poiType === 'heat') {\n                  const heatPoint = {\n                    lng: translatedItem.point.lng,\n                    lat: translatedItem.point.lat,\n                    count: getPoiExt(translatedItem.gps, 'count', 1)\n                  };\n                  heatArray.push(heatPoint);\n                } else if (poiType === 'line' || poiType === 'polygon') {\n                  const pointItem = translatedItem.point;\n                  if (poiIndexKey in lineMap) {\n                    lineMap[poiIndexKey].points.push(pointItem);\n                  } else {\n                    lineMap[poiIndexKey] = {\n                      poiType: poiType,\n                      strokeColor: getPoiExt(translatedItem.gps, 'strokeColor', 'blue'),\n                      strokeWeight: getPoiExt(translatedItem.gps, 'strokeWeight', '4'),\n                      points: [pointItem]\n                    };\n                  }\n                } else {\n                  markerArray.push({point: translatedItem.point, data: translatedItem.gps});\n                }\n              }\n              console.log('markerArray', markerArray);\n              console.log('lineMap', lineMap);\n              console.log('heatArray', heatArray);\n\n              if (heatArray.length > 0) {\n                // 热力图\n                if (!isSupportCanvas()) {\n                  alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~');\n                }\n                // http://xcx1024.com/ArtInfo/271881.html\n                const heatmapOverlay = new BMapLib.HeatmapOverlay({radius: 20});\n                that.map.addOverlay(heatmapOverlay);\n                heatmapOverlay.setDataSet({data: heatArray, max: 100});\n\n                function setGradient() {\n                  const gradient = {};\n                  let colors = document.querySelectorAll('input[type=\\'color\\']');\n                  colors = [].slice.call(colors, 0);\n                  colors.forEach(function (ele) {\n                    gradient[ele.getAttribute('data-key')] = ele.value;\n                  });\n                  heatmapOverlay.setOptions({gradient: gradient});\n                }\n\n                // 判断浏览区是否支持canvas\n                function isSupportCanvas() {\n                  const elem = document.createElement('canvas');\n                  return !!(elem.getContext && elem.getContext('2d'));\n                }\n\n                function ZoomControl() {\n                  // 默认停靠位置和偏移量\n                  this.defaultAnchor = BMAP_ANCHOR_BOTTOM_RIGHT;\n                  this.defaultOffset = new BMap.Size(10, 10);\n                }\n\n                ZoomControl.prototype = new BMap.Control();\n                ZoomControl.prototype.initialize = function (map) {\n                  // let div = document.createElement('div');\n                  // let content = '<div id=\"heatmap_mark\"><div><span class=\"heatmap_mark_title\">颜色对应RSSI信号强度</span> <span class=\"heatmap_mark_text\" style=\"float:right;padding-top:5px\" id=\"heatmap_mark_density\">dBm</span></div><div class=\"linear_color\"></div><span class=\"heatmap_blue heatmap_mark_text heatmap_color_span\">-60以下</span><span class=\"heatmap_green heatmap_mark_text heatmap_color_span\">-60至-80</span><span class=\"heatmap_yellow heatmap_mark_text heatmap_color_span\">-80至-100</span><span class=\"heatmap_red heatmap_mark_text heatmap_color_span\">-100至-120</span><span class=\"heatmap_result_red heatmap_mark_text heatmap_color_span\">-120以上</span></div>';\n                  // div.innerHTML = content;\n                  //\n                  // that.map.getContainer()\n                  //   .appendChild(div);\n                  // return div;\n                };\n\n                const myZoomCtrl = new ZoomControl();\n                // eslint-disable-next-line eqeqeq\n                that.map.addControl(myZoomCtrl);\n                // eslint-disable-next-line eqeqeq\n              }\n              const lineCount = Object.keys(lineMap).length;\n              if (lineCount > 0) {\n                for (let i = 0; i < lineCount; i++) {\n                  const lines = Object.values(lineMap)[i];\n                  const strokeColor = lines.strokeColor;\n                  const strokeWeight = lines.strokeWeight;\n                  if (lines.poiType === 'polygon') {\n                    lines.points.push(lines.points[0]);\n                  }\n                  const polyline = new BMap.Polyline(lines.points, {\n                    enableEditing: false,\n                    enableClicking: true,\n                    strokeWeight: strokeWeight,\n                    strokeOpacity: 0.5,\n                    strokeColor: strokeColor\n                  });\n                  that.map.addOverlay(polyline);\n                }\n              }\n              if (markerArray.length > 0) {\n                for (let i = 0; i < markerArray.length; i++) {\n                  that.addMarker(markerArray[i].point, BMap, markerArray[i].data);\n                }\n                new BMapLib.MarkerClusterer(that.map, {\n                  markers: that.markers\n                });\n              }\n            }\n          } else {\n            console.log('转换出错: ' + returnedData.status);\n          }\n        }\n\n        // 转换坐标\n        const point = new BMap.Point(gps.lng, gps.lat);\n        convertor.translate(new Array(point), 5, 5, translateCallback); // 不转换\n      }\n    }\n  }\n\n  filterEmptyAndZeroValues(data) {\n    return _.filter(data, (o) => {\n      return !(this.panel.hideEmpty && _.isNil(o.value)) && !(this.panel.hideZero && o.value === 0);\n    });\n  }\n\n  onDataSnapshotLoad(snapshotData) {\n    this.onDataReceived(snapshotData);\n  }\n\n  seriesHandler(seriesData) {\n    const series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target,\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  setNewMapCenter() {\n    this.render();\n  }\n\n  setZoom() {\n    this.map.setZoom(parseInt(this.panel.initialZoom, 10) || 1);\n  }\n\n  setStyle() {\n    this.map.setMapStyle({style: this.panel.theme});\n  }\n\n  setAK() {\n    const x = document.body;\n    const s = document.getElementsByTagName('script');\n    const len = s.length;\n    x.removeChild(s[len - 1]);\n    delete this.map;\n    this.render();\n  }\n\n  navigationControl() {\n    if (this.panel.navigation == true) {\n      this.map.addControl(this.navigationSwitch);\n    } else {\n      this.map.removeControl(this.navigationSwitch);\n    }\n  }\n\n  scaleControl() {\n    if (this.panel.scale == true) {\n      this.map.addControl(this.scaleSwitch);\n    } else {\n      this.map.removeControl(this.scaleSwitch);\n    }\n  }\n\n  overviewMapControl() {\n    if (this.panel.overviewMap == true) {\n      this.map.addControl(this.overviewMapSwitch);\n    } else {\n      this.map.removeControl(this.overviewMapSwitch);\n    }\n  }\n\n  mapTypeControl() {\n    if (this.panel.mapType == true) {\n      this.map.addControl(this.mapTypeSwitch);\n    } else {\n      this.map.removeControl(this.mapTypeSwitch);\n    }\n  }\n\n  resize() {\n\n  }\n\n  toggleStickyLabels() {\n    console.log(this.panel.stickyLabels);\n  }\n\n  changeLocationData() {\n    if (this.panel.locationData === 'geohash') {\n      this.render();\n    }\n  }\n\n  /* eslint class-methods-use-this: 0 */\n  link(scope, elem, attrs, ctrl) {\n    mapRenderer(scope, elem, attrs, ctrl);\n  }\n}\n\nBaidumapCtrl.templateUrl = 'module.html';\n"]}